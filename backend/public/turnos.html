<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agendar Turno de Lavado de Autos en Reconquista | Reserva Online | Daytona Clean Service</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Agend√° tu turno de lavado de autos en Reconquista online. Reserva f√°cil y r√°pido para limpieza de veh√≠culos, tapizados y detailing. ¬°Servicio a domicilio!" />
  <meta name="keywords" content="agendar turno lavado autos Reconquista, reserva online lavado, turnos lavado autos, agendar limpieza tapizados, reserva detailing Reconquista, turnos servicio domicilio, agendar Daytona Clean Service" />
  <meta name="author" content="Daytona Clean Service - Benjam√≠n Gianneschi" />
  <meta name="robots" content="index, follow" />
  <meta name="language" content="Spanish" />
  <meta name="geo.region" content="AR-SF" />
  <meta name="geo.placename" content="Reconquista, Santa Fe, Argentina" />
  <meta name="geo.position" content="-29.153022;-59.639699" />
  <meta name="ICBM" content="-29.153022, -59.639699" />
  
  <!-- Open Graph -->
  <meta property="og:title" content="Agendar Turno de Lavado de Autos en Reconquista" />
  <meta property="og:description" content="Agend√° tu turno de lavado de autos online. Reserva f√°cil para limpieza de veh√≠culos y tapizados en Reconquista." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://daytona.com.ar/turnos.html" />
  <meta property="og:site_name" content="Daytona Clean Service" />
  <meta property="og:locale" content="es_AR" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Agendar Turno Lavado de Autos Reconquista" />
  <meta name="twitter:description" content="Agend√° tu turno de lavado de autos online. Reserva f√°cil en Reconquista." />
  
  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ReservationPage",
    "name": "Agendar Turno de Lavado de Autos",
    "description": "P√°gina para agendar turnos de lavado de autos y limpieza de tapizados en Reconquista",
    "provider": {
      "@type": "LocalBusiness",
      "name": "Daytona Clean Service",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Ituzaingo 1455",
        "addressLocality": "Reconquista",
        "addressRegion": "Santa Fe",
        "addressCountry": "AR"
      },
      "telephone": "+5493482588383"
    },
    "areaServed": "Reconquista, Santa Fe, Argentina",
    "serviceType": ["Lavado de Autos", "Limpieza de Tapizados", "Detailing"],
    "availableService": [
      {
        "@type": "Service",
        "name": "Limpieza Convencional",
        "price": "20000",
        "priceCurrency": "ARS"
      },
      {
        "@type": "Service",
        "name": "Limpieza Detallada",
        "price": "100000",
        "priceCurrency": "ARS"
      },
      {
        "@type": "Service",
        "name": "Limpieza de Tapizados",
        "price": "100000",
        "priceCurrency": "ARS"
      }
    ]
  }
  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/index.css" />
  <link rel="stylesheet" href="css/components/header.css" />
  <link rel="stylesheet" href="css/vehiculos.css">
  <link rel="stylesheet" href="css/tapizados.css">
  <link rel="icon" href="/img/favicon.ico" type="image/x-icon" />
  <style>
    body {
      background: #181818;
      color: #fff;
      font-family: 'Roboto', Arial, sans-serif;
      min-height: 100vh;
    }
    .wizard-step {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #fff;
      font-weight: 500;
      padding: 10px 0;
    }
    .wizard-step.active {
      color: #ff3b3f;
    }
    .wizard-bar {
      height: 4px;
      background: linear-gradient(90deg, #ff3b3f 0%, #b31217 100%);
      border-radius: 2px;
      margin-bottom: 30px;
    }
    .card-turno {
      background: #232323;
      border-radius: 12px;
      border: 1.5px solid #ff3b3f;
      margin-bottom: 24px;
      padding: 24px;
      color: #fff;
    }
    .servicio-card {
      background: #232323;
      border: 1.5px solid #ff3b3f;
      border-radius: 10px;
      padding: 18px 20px;
      margin-bottom: 18px;
      cursor: pointer;
      transition: box-shadow 0.2s, border 0.2s;
    }
    .servicio-card.selected, .servicio-card:hover {
      border: 2.5px solid #ff3b3f;
      box-shadow: 0 0 12px #ff3b3f44;
    }
    .servicio-precio {
      color: #ff3b3f;
      font-weight: 700;
      font-size: 1.2rem;
    }
    .step-btn {
      background: #ff3b3f;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 28px;
      font-weight: 600;
      margin-top: 18px;
      transition: background 0.2s;
    }
    .step-btn:hover {
      background: #b31217;
    }
    .step-btn[disabled] {
      background: #444;
      color: #bbb;
      cursor: not-allowed;
    }
    .resumen-turno {
      background: #232323;
      border: 1.5px solid #ff3b3f;
      border-radius: 10px;
      padding: 18px 20px;
      margin-bottom: 18px;
    }
    .form-label {
      color: #fff;
      font-weight: 500;
    }
    .form-control, .form-select {
      background: #232323;
      color: #fff;
      border: 1px solid #444;
    }
    .form-control:focus, .form-select:focus {
      border-color: #ff3b3f;
      box-shadow: 0 0 0 0.2rem #ff3b3f33;
    }
    .wizard-nav {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      gap: 10px;
    }
    @media (max-width: 600px) {
      .wizard-nav {
        flex-direction: column;
        gap: 8px;
      }
      .card-turno, .resumen-turno {
        padding: 12px 8px;
      }
      .container.py-5 {
        margin-top: 70px !important;
        padding-top: 20px !important;
      }
    }
    .wizard-progress-container {
      width: 100%;
      margin-bottom: 32px;
    }
    .wizard-bar-bg {
      width: 100%;
      height: 7px;
      background: #232323;
      border-radius: 4px;
      position: relative;
      margin-bottom: 18px;
      overflow: hidden;
    }
    .wizard-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff3b3f 0%, #b31217 100%);
      border-radius: 4px;
      width: 0%;
      transition: width 0.4s cubic-bezier(.4,1.3,.6,1);
    }
    .wizard-nav-modern {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    .wizard-step-modern {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      color: #fff;
      font-weight: 500;
      font-size: 0.98rem;
      position: relative;
      z-index: 2;
    }
    .wizard-icon-circle {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: #232323;
      border: 2.5px solid #b31217;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      margin-bottom: 6px;
      color: #ff3b3f;
      transition: border 0.3s, background 0.3s, color 0.3s;
    }
    .wizard-step-modern.active .wizard-icon-circle {
      background: #ff3b3f;
      color: #fff;
      border: 2.5px solid #ff3b3f;
      box-shadow: 0 0 8px #ff3b3f66;
    }
    .wizard-step-modern.completed .wizard-icon-circle {
      background: #b31217;
      color: #fff;
      border: 2.5px solid #b31217;
    }
    .wizard-step-modern span {
      font-size: 0.93rem;
      margin-top: 2px;
      color: #fff;
    }
    @media (max-width: 600px) {
      .wizard-nav-modern {
        flex-direction: column;
        gap: 10px;
      }
      .wizard-step-modern {
        flex-direction: row;
        gap: 10px;
        align-items: center;
        width: 100%;
        justify-content: flex-start;
      }
      .wizard-step-modern span {
        margin-top: 0;
      }
    }
    /* Contenedor visual moderno para el turnero */
    .turnero-contenedor-moderno {
      background: #232323;
      border-radius: 18px;
      padding: 32px 24px 80px 24px;
      margin: 0 auto 32px auto;
      position: relative;
      min-height: 600px;
      max-width: 500px;
    }
    .wizard-content-moderno {
      min-height: 320px;
    }
    .turnero-botones-fijos {
      /* position: absolute; */
      position: static;
      left: unset;
      right: unset;
      bottom: unset;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 24px;
      background: linear-gradient(0deg, #181818 90%, #23232300 100%);
      border-bottom-left-radius: 18px;
      border-bottom-right-radius: 18px;
      z-index: 10;
      min-height: 70px;
      margin-top: 32px;
    }
    .turnero-botones-fijos .btn,
    .turnero-botones-fijos .step-btn {
      min-width: 120px;
      margin: 0;
    }
    @media (max-width: 600px) {
      .turnero-contenedor-moderno {
        padding: 16px 4px 80px 4px;
        min-height: 400px;
        max-width: 100vw;
      }
      .turnero-botones-fijos {
        padding: 10px 6px;
        min-height: 60px;
      }
      .turnero-botones-fijos .btn,
      .turnero-botones-fijos .step-btn {
        min-width: 90px;
        font-size: 0.95rem;
      }
    }
    /* Dropdown de servicios con iconos */
    .servicio-dropdown {
      font-size: 1.1rem;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1.5px solid #ff3b3f;
      background: #232323;
      color: #fff;
      margin-bottom: 10px;
    }
    .servicio-dropdown:focus {
      border-color: #ff3b3f;
      box-shadow: 0 0 0 0.2rem #ff3b3f33;
    }
    #servicio-detalle {
      font-size: 1.05rem;
      background: #232323;
      border: 1.5px solid #ff3b3f;
      border-radius: 8px;
      margin-top: 8px;
      min-height: 48px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #servicio-detalle i {
      font-size: 1.5rem;
      color: #ff3b3f;
      margin-right: 10px;
    }
    /* Botones iguales y bien ubicados */
    .turnero-botones-fijos .btn,
    .turnero-botones-fijos .step-btn {
      min-width: 140px;
      max-width: 180px;
      font-size: 1.08rem;
      border-radius: 8px;
      padding: 12px 0;
      margin: 0;
      box-sizing: border-box;
    }
    .turnero-botones-fijos {
      justify-content: space-between;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div id="header-container"></div>
  <div class="container py-5" style="max-width: 600px; margin-top: 80px;">
    <div class="turnero-contenedor-moderno">
      <h1 class="fw-bold text-center mb-2" style="color: #fff;">Agenda tu Turno</h1>
      <p class="text-center mb-4" style="color: #fff;">Reserva tu cita de forma r√°pida y sencilla. Te confirmaremos por WhatsApp y te enviaremos recordatorios autom√°ticos.</p>
      
      <!-- Wizard Steps -->
      <div class="wizard-progress-container mb-4">
        <div class="wizard-bar-bg">
          <div class="wizard-bar-fill" id="wizard-bar-fill"></div>
        </div>
        <div class="wizard-nav-modern">
          <div class="wizard-step-modern" id="step-indicator-1">
            <div class="wizard-icon-circle"><i class="fas fa-cogs"></i></div>
            <span>Servicio</span>
          </div>
          <div class="wizard-step-modern" id="step-indicator-2">
            <div class="wizard-icon-circle"><i class="fas fa-user"></i></div>
            <span>Agente</span>
          </div>
          <div class="wizard-step-modern" id="step-indicator-3">
            <div class="wizard-icon-circle"><i class="fas fa-calendar-alt"></i></div>
            <span>Turno</span>
          </div>
          <div class="wizard-step-modern" id="step-indicator-4">
            <div class="wizard-icon-circle"><i class="fas fa-user-edit"></i></div>
            <span>Datos</span>
          </div>
          <div class="wizard-step-modern" id="step-indicator-5">
            <div class="wizard-icon-circle"><i class="fas fa-map-marker-alt"></i></div>
            <span>Ubicaci√≥n</span>
          </div>
          <div class="wizard-step-modern" id="step-indicator-6">
            <div class="wizard-icon-circle"><i class="fas fa-check-circle"></i></div>
            <span>Confirmar</span>
          </div>
        </div>
      </div>
      <!-- Fin Wizard Steps -->
      <div class="wizard-bar"></div>
      <!-- Wizard Content -->
      <div id="wizard-content">
        <!-- Paso 1: Seleccionar Servicio -->
        <div id="step-1">
          <h3 class="mb-3">Seleccionar Servicio</h3>
          <div class="mb-3">
            <label for="servicio-select" class="form-label">Servicio *</label>
            <select class="form-select servicio-dropdown" id="servicio-select" required>
              <option value="" data-icon="">Selecciona un servicio</option>
              <option value="Limpieza de Veh√≠culo" data-duracion="180" data-precio="15000" data-icon="fa-car">Limpieza de Veh√≠culo</option>
              <option value="Limpieza de Tapizado de Veh√≠culo" data-duracion="120" data-precio="20000" data-icon="fa-car-side">Limpieza de Tapizado de Veh√≠culo</option>
              <option value="Limpieza de Motor" data-duracion="45" data-precio="12000" data-icon="fa-gears">Limpieza de Motor</option>
              <option value="Limpieza de Sillones" data-duracion="80" data-precio="18000" data-icon="fa-couch">Limpieza de Sillones</option>
              <option value="Limpieza de Sillas" data-duracion="40" data-precio="7000" data-icon="fa-chair">Limpieza de Sillas</option>
              <option value="Limpieza de Colchones" data-duracion="60" data-precio="12000" data-icon="fa-bed">Limpieza de Colchones</option>
              <option value="Limpieza de Alfombras" data-duracion="120" data-precio="20000" data-icon="fa-rug">Limpieza de Alfombras</option>
              <option value="Limpieza de Puff" data-duracion="60" data-precio="10500" data-icon="fa-couch">Limpieza de Puff</option>
            </select>
          </div>

          <!-- Botones de tipo de sill√≥n (aparecen solo cuando se selecciona Limpieza de Sillones) -->
          <div id="sillon-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de sill√≥n:</strong></div>
            <div class="btn-group" role="group" id="sillon-tipos">
              <input type="radio" class="btn-check" name="sillon-tipo" id="sillon-1cuerpo" value="1 cuerpo" autocomplete="off">
              <label class="btn btn-outline-primary" for="sillon-1cuerpo">
                <i class="fas fa-couch me-1"></i>1 Cuerpo
              </label>
              
              <input type="radio" class="btn-check" name="sillon-tipo" id="sillon-2cuerpos" value="2 cuerpos" autocomplete="off">
              <label class="btn btn-outline-primary" for="sillon-2cuerpos">
                <i class="fas fa-couch me-1"></i>2 Cuerpos
              </label>
              
              <input type="radio" class="btn-check" name="sillon-tipo" id="sillon-3cuerpos" value="3 cuerpos" autocomplete="off">
              <label class="btn btn-outline-primary" for="sillon-3cuerpos">
                <i class="fas fa-couch me-1"></i>3 Cuerpos
              </label>
              

            </div>
          </div>

          <!-- Botones de tipo de silla (aparecen solo cuando se selecciona Limpieza de Sillas) -->
          <div id="silla-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de silla:</strong></div>
            <div class="btn-group" role="group" id="silla-tipos">
              <input type="radio" class="btn-check" name="silla-tipo" id="silla-simple" value="simple" autocomplete="off">
              <label class="btn btn-outline-primary" for="silla-simple">
                <i class="fas fa-chair me-1"></i>Simple
              </label>
              
              <input type="radio" class="btn-check" name="silla-tipo" id="silla-gamer" value="gamer" autocomplete="off">
              <label class="btn btn-outline-primary" for="silla-gamer">
                <i class="fas fa-chair me-1"></i>Gamer
              </label>
              
              <input type="radio" class="btn-check" name="silla-tipo" id="silla-oficina" value="oficina" autocomplete="off">
              <label class="btn btn-outline-primary" for="silla-oficina">
                <i class="fas fa-chair me-1"></i>Oficina
              </label>
              
              <input type="radio" class="btn-check" name="silla-tipo" id="silla-comedor" value="comedor" autocomplete="off">
              <label class="btn btn-outline-primary" for="silla-comedor">
                <i class="fas fa-chair me-1"></i>Comedor
              </label>
            </div>
          </div>

          <!-- Botones de tipo de colch√≥n (aparecen solo cuando se selecciona Limpieza de Colchones) -->
          <div id="colchon-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de colch√≥n:</strong></div>
            <div class="btn-group" role="group" id="colchon-tipos">
              <input type="radio" class="btn-check" name="colchon-tipo" id="colchon-1plaza" value="1 plaza" autocomplete="off">
              <label class="btn btn-outline-primary" for="colchon-1plaza">
                <i class="fas fa-bed me-1"></i>1 Plaza
              </label>
              
              <input type="radio" class="btn-check" name="colchon-tipo" id="colchon-2plazas" value="2 plazas" autocomplete="off">
              <label class="btn btn-outline-primary" for="colchon-2plazas">
                <i class="fas fa-bed me-1"></i>2 Plazas
              </label>
              

            </div>
          </div>

          <!-- Botones de tipo de veh√≠culo (aparecen solo cuando se selecciona Limpieza de Veh√≠culo) -->
          <div id="vehiculo-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de veh√≠culo:</strong></div>
            <div class="btn-group" role="group" id="vehiculo-tipos">
              <input type="radio" class="btn-check" name="vehiculo-tipo" id="vehiculo-auto" value="auto" autocomplete="off">
              <label class="btn btn-outline-primary" for="vehiculo-auto">
                <i class="fas fa-car me-1"></i>Auto
              </label>
              <input type="radio" class="btn-check" name="vehiculo-tipo" id="vehiculo-suv" value="suv" autocomplete="off">
              <label class="btn btn-outline-primary" for="vehiculo-suv">
                <i class="fas fa-car-side me-1"></i>SUV
              </label>
              <input type="radio" class="btn-check" name="vehiculo-tipo" id="vehiculo-pickup" value="pickup" autocomplete="off">
              <label class="btn btn-outline-primary" for="vehiculo-pickup">
                <i class="fas fa-truck-pickup me-1"></i>Pickup
              </label>
            </div>
          </div>

          <!-- Botones de tipo de tapizado de veh√≠culo (aparecen solo cuando se selecciona Limpieza de Tapizado de Veh√≠culo) -->
          <div id="tapizadovehiculo-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de veh√≠culo para tapizado:</strong></div>
            <div class="btn-group" role="group" id="tapizadovehiculo-tipos">
              <input type="radio" class="btn-check" name="tapizadovehiculo-tipo" id="tapizadovehiculo-auto" value="auto" autocomplete="off">
              <label class="btn btn-outline-primary" for="tapizadovehiculo-auto">
                <i class="fas fa-car me-1"></i>Auto
              </label>
              <input type="radio" class="btn-check" name="tapizadovehiculo-tipo" id="tapizadovehiculo-suv" value="suv" autocomplete="off">
              <label class="btn btn-outline-primary" for="tapizadovehiculo-suv">
                <i class="fas fa-car-side me-1"></i>SUV
              </label>
              <input type="radio" class="btn-check" name="tapizadovehiculo-tipo" id="tapizadovehiculo-pickup" value="pickup" autocomplete="off">
              <label class="btn btn-outline-primary" for="tapizadovehiculo-pickup">
                <i class="fas fa-truck-pickup me-1"></i>Pickup
              </label>
            </div>
          </div>
          <div id="tapizadovehiculos-seleccionados" class="mb-3"></div>
          <div id="tapizadovehiculos-total" class="fw-bold mt-3"></div>

          <!-- Botones de tipo de motor (aparecen solo cuando se selecciona Limpieza de Motor) -->
          <div id="motor-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de limpieza de motor:</strong></div>
            <div class="btn-group" role="group" id="motor-tipos">
              <input type="radio" class="btn-check" name="motor-tipo" id="motor-basica" value="basica" autocomplete="off">
              <label class="btn btn-outline-primary" for="motor-basica">
                <i class="fas fa-gears me-1"></i>B√°sica
              </label>
              
              <input type="radio" class="btn-check" name="motor-tipo" id="motor-completa" value="completa" autocomplete="off">
              <label class="btn btn-outline-primary" for="motor-completa">
                <i class="fas fa-gears me-1"></i>Completa
              </label>
              
              <input type="radio" class="btn-check" name="motor-tipo" id="motor-detallada" value="detallada" autocomplete="off">
              <label class="btn btn-outline-primary" for="motor-detallada">
                <i class="fas fa-gears me-1"></i>Detallada
              </label>
            </div>
          </div>

          <!-- Botones de tipo de alfombra (aparecen solo cuando se selecciona Limpieza de Alfombras) -->
          <div id="alfombra-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de alfombra:</strong></div>
            <div class="btn-group" role="group" id="alfombra-tipos">
              <input type="radio" class="btn-check" name="alfombra-tipo" id="alfombra-chica" value="chica" autocomplete="off">
              <label class="btn btn-outline-primary" for="alfombra-chica">
                <i class="fas fa-rug me-1"></i>Chica (2x3m)
              </label>
              
              <input type="radio" class="btn-check" name="alfombra-tipo" id="alfombra-mediana" value="mediana" autocomplete="off">
              <label class="btn btn-outline-primary" for="alfombra-mediana">
                <i class="fas fa-rug me-1"></i>Mediana (3x4m)
              </label>
              
              <input type="radio" class="btn-check" name="alfombra-tipo" id="alfombra-grande" value="grande" autocomplete="off">
              <label class="btn btn-outline-primary" for="alfombra-grande">
                <i class="fas fa-rug me-1"></i>Grande (4x5m)
              </label>
              
              <input type="radio" class="btn-check" name="alfombra-tipo" id="alfombra-persa" value="persa" autocomplete="off">
              <label class="btn btn-outline-primary" for="alfombra-persa">
                <i class="fas fa-rug me-1"></i>Persa
              </label>
            </div>
          </div>

          <!-- Botones de tipo de puff (aparecen solo cuando se selecciona Limpieza de Puff) -->
          <div id="puff-tipos-container" style="display:none;" class="mb-3">
            <div class="mb-2"><strong>Eleg√≠ el tipo de puff:</strong></div>
            <div class="btn-group" role="group" id="puff-tipos">
              <input type="radio" class="btn-check" name="puff-tipo" id="puff-simple" value="simple" autocomplete="off">
              <label class="btn btn-outline-primary" for="puff-simple">
                <i class="fas fa-couch me-1"></i>Simple
              </label>
              
              <input type="radio" class="btn-check" name="puff-tipo" id="puff-grande" value="grande" autocomplete="off">
              <label class="btn btn-outline-primary" for="puff-grande">
                <i class="fas fa-couch me-1"></i>Grande
              </label>
              
              <input type="radio" class="btn-check" name="puff-tipo" id="puff-especial" value="especial" autocomplete="off">
              <label class="btn btn-outline-primary" for="puff-especial">
                <i class="fas fa-couch me-1"></i>Especial
              </label>
            </div>
          </div>

          <!-- Detalle del servicio seleccionado (solo para servicios que no son sillones) -->
          <div id="servicio-detalle" class="mb-3" style="display:none;">
            <!-- El contenido se genera din√°micamente -->
          </div>

          <!-- Cards de sillones seleccionados -->
          <div id="sillones-seleccionados" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de sillas seleccionadas -->
          <div id="sillas-seleccionadas" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de colchones seleccionados -->
          <div id="colchones-seleccionados" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de veh√≠culos seleccionados -->
          <div id="vehiculos-seleccionados" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de motores seleccionados -->
          <div id="motores-seleccionados" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de alfombras seleccionadas -->
          <div id="alfombras-seleccionadas" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>

          <!-- Cards de puffs seleccionados -->
          <div id="puffs-seleccionados" class="mb-3">
            <!-- Las cards se generan din√°micamente -->
          </div>
          
          <div id="sillones-total" class="fw-bold mt-3"></div>
          <div id="sillas-total" class="fw-bold mt-3"></div>
          <div id="colchones-total" class="fw-bold mt-3"></div>
          <div id="vehiculos-total" class="fw-bold mt-3"></div>
          <div id="motores-total" class="fw-bold mt-3"></div>
          <div id="alfombras-total" class="fw-bold mt-3"></div>
          <div id="puffs-total" class="fw-bold mt-3"></div>
          
          <!-- Resumen final de todos los servicios -->
          <div id="resumen-final" class="mt-4" style="display:none; margin-bottom: 1.5rem;">
            <div class="card-turno">
              <h5 class="mb-3">
                <i class="fas fa-list-ul me-2 text-danger"></i>
                Resumen de Servicios
              </h5>
              <div id="lista-servicios" class="mb-3">
                <!-- Los servicios se mostrar√°n aqu√≠ -->
              </div>
              <hr style="border-color: #ff3b3f;">
              <div class="d-flex justify-content-between align-items-center">
                <strong class="text-white">Total General:</strong>
                <strong class="text-danger fs-4" id="total-general">$0</strong>
              </div>
            </div>
          </div>
        </div>
        <!-- Paso 2: Seleccionar Profesional -->
        <div id="step-2" style="display:none;">
          <h3 class="mb-3">Seleccionar Profesional</h3>
          <div class="servicio-card selected" id="profesional-benjamin" data-nombre="Benjam√≠n Gianneschi">
            <div class="d-flex align-items-center">
              <i class="fas fa-user-circle fa-2x me-3"></i>
              <div>
                <strong>Benjam√≠n Gianneschi</strong>
                <div class="text-muted small">Especialista en limpieza profesional</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Paso 3: Seleccionar Fecha y Hora -->
        <div id="step-3" style="display:none;">
          <h3 class="mb-3">Seleccionar Fecha y Hora</h3>
          
          <!-- Informaci√≥n sobre turnos separados -->
          <div id="info-turnos-separados" class="alert alert-info mb-4" style="display:none; background: #232323; color: #fff; border: 1.5px solid #17a2b8;">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Turnos Separados:</strong> Has seleccionado servicios de diferentes categor√≠as. 
            Los servicios de veh√≠culos y tapizados se realizar√°n en turnos separados para optimizar el tiempo y la calidad del servicio.
          </div>
          
          <!-- Turno para Veh√≠culos -->
          <div id="turno-vehiculos" style="display:none;">
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-car me-2 text-danger"></i>
                Turno para Servicios de Veh√≠culos
              </h5>
              <div id="servicios-vehiculos-resumen" class="mb-3"></div>
              <form id="fecha-hora-vehiculos-form">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="fecha-vehiculos" class="form-label">Fecha *</label>
                    <input type="date" class="form-control" id="fecha-vehiculos" min="" required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="hora-vehiculos" class="form-label">Hora *</label>
                    <select class="form-select" id="hora-vehiculos" required>
                      <option value="">Selecciona una hora</option>
                      <option>09:00</option>
                      <option>10:00</option>
                      <option>11:00</option>
                      <option>12:00</option>
                      <option>13:00</option>
                      <option>14:00</option>
                      <option>15:00</option>
                      <option>16:00</option>
                      <option>17:00</option>
                    </select>
                  </div>
                </div>
              </form>
            </div>
          </div>
          
          <!-- Turno para Tapizados -->
          <div id="turno-tapizados" style="display:none;">
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-couch me-2 text-danger"></i>
                Turno para Servicios de Tapizados
              </h5>
              <div id="servicios-tapizados-resumen" class="mb-3"></div>
              <form id="fecha-hora-tapizados-form">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="fecha-tapizados" class="form-label">Fecha *</label>
                    <input type="date" class="form-control" id="fecha-tapizados" min="" required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="hora-tapizados" class="form-label">Hora *</label>
                    <select class="form-select" id="hora-tapizados" required>
                      <option value="">Selecciona una hora</option>
                      <option>09:00</option>
                      <option>10:00</option>
                      <option>11:00</option>
                      <option>12:00</option>
                      <option>13:00</option>
                      <option>14:00</option>
                      <option>15:00</option>
                      <option>16:00</option>
                      <option>17:00</option>
                    </select>
                  </div>
                </div>
              </form>
            </div>
          </div>
          
          <!-- Turno √∫nico (cuando solo hay una categor√≠a) -->
          <div id="turno-unico" style="display:none;">
            <form id="fecha-hora-form">
              <div class="mb-3">
                <label for="fecha" class="form-label">Fecha *</label>
                <input type="date" class="form-control" id="fecha" min="" required />
              </div>
              <div class="mb-3">
                <label for="hora" class="form-label">Hora *</label>
                <select class="form-select" id="hora" required>
                  <option value="">Selecciona una hora</option>
                  <option>09:00</option>
                  <option>10:00</option>
                  <option>11:00</option>
                  <option>12:00</option>
                  <option>13:00</option>
                  <option>14:00</option>
                  <option>15:00</option>
                  <option>16:00</option>
                  <option>17:00</option>
                </select>
              </div>
            </form>
          </div>
        </div>
        <!-- Paso 4: Datos Personales -->
        <div id="step-4" style="display:none;">
          <h3 class="mb-3">Datos Personales</h3>
          
          <!-- Mensaje para usuarios logueados -->
          <div id="usuario-logueado-info" class="alert alert-info mb-4" style="display:none; background: #232323; color: #fff; border: 1.5px solid #17a2b8;">
            <i class="fas fa-user-check me-2"></i>
            <strong>¬°Bienvenido de vuelta!</strong> Tus datos han sido auto-completados desde tu cuenta. 
            Puedes modificarlos si es necesario.
          </div>
          
          <form id="datos-personales-form">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="nombre" class="form-label">Nombre *</label>
                <input type="text" class="form-control" id="nombre" required />
              </div>
              <div class="col-md-6 mb-3">
                <label for="apellido" class="form-label">Apellido *</label>
                <input type="text" class="form-control" id="apellido" required />
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="telefono" class="form-label">Tel√©fono *</label>
                <input type="tel" class="form-control" id="telefono" placeholder="+54 9 3482 123456" required />
                <small class="text-muted">Para confirmar tu turno por WhatsApp</small>
              </div>
              <div class="col-md-6 mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" placeholder="tu@email.com" />
                <small class="text-muted">Opcional - Para enviarte recordatorios</small>
              </div>
            </div>
          </form>
        </div>
        
        <!-- Paso 5: Ubicaci√≥n del Servicio -->
        <div id="step-5" style="display:none;">
          <h3 class="mb-3">Ubicaci√≥n del Servicio</h3>
          
          <!-- Ubicaci√≥n para Veh√≠culos -->
          <div id="ubicacion-vehiculos" style="display:none;">
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-car me-2 text-danger"></i>
                Ubicaci√≥n para Servicios de Veh√≠culos
              </h5>
              <div id="ubicacion-vehiculos-container">
                <!-- Los campos se mostrar√°n din√°micamente -->
              </div>
            </div>
          </div>
          
          <!-- Ubicaci√≥n para Tapizados -->
          <div id="ubicacion-tapizados" style="display:none;">
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-couch me-2 text-danger"></i>
                Ubicaci√≥n para Servicios de Tapizados
              </h5>
              <div id="ubicacion-tapizados-container">
                <!-- Los campos se mostrar√°n din√°micamente -->
              </div>
            </div>
          </div>
          
          <!-- Ubicaci√≥n √∫nica (cuando solo hay una categor√≠a) -->
          <div id="ubicacion-unica" style="display:none;">
            <div id="ubicacion-container">
              <!-- Los campos se mostrar√°n din√°micamente seg√∫n el tipo de servicio -->
            </div>
          </div>
        </div>
        <!-- Paso 6: Confirmar -->
        <div id="step-6" style="display:none;">
          <h3 class="mb-3">Confirmar Turnos</h3>
          
          <!-- Resumen de turnos separados -->
          <div id="resumen-turnos-separados" style="display:none;">
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-car me-2 text-danger"></i>
                Turno para Servicios de Veh√≠culos
              </h5>
              <div id="resumen-turno-vehiculos"></div>
            </div>
            
            <div class="card-turno mb-4">
              <h5 class="mb-3">
                <i class="fas fa-couch me-2 text-danger"></i>
                Turno para Servicios de Tapizados
              </h5>
              <div id="resumen-turno-tapizados"></div>
            </div>
          </div>
          
          <!-- Resumen de turno √∫nico -->
          <div id="resumen-turno-unico" style="display:none;">
            <div class="resumen-turno" id="resumen-turno"></div>
          </div>
          
          <div id="resumen-final" class="mt-4" style="display:block; margin-bottom: 1.5rem;"></div>
        </div>
        <!-- Mensaje de √©xito -->
        <div id="turno-exito" style="display:none;">
          <div class="alert alert-success mt-4" style="background: #232323; color: #fff; border: 1.5px solid #28a745;">
            <h4 class="mb-2">¬°Turno guardado exitosamente!</h4>
            <p>Tu turno ha sido guardado en nuestro historial. Te contactaremos pronto para coordinar los detalles de tu servicio.</p>
            <p class="mb-0"><small>üìã El turno qued√≥ registrado en nuestro sistema para seguimiento.</small></p>
            <div id="botones-exito" class="mt-3">
              <!-- Los botones se agregar√°n din√°micamente -->
            </div>
          </div>
        </div>
      </div>
      <!-- Botonera fija inferior -->
      <div class="turnero-botones-fijos">
        <button type="button" class="btn btn-secondary" id="btn-anterior-fijo" style="display:none;">Anterior</button>
        <button type="button" class="step-btn" id="btn-siguiente-fijo" style="display:none;">Siguiente</button>
        <button type="button" class="step-btn" id="btn-confirmar-fijo" style="display:none;">Confirmar Turno</button>
      </div>
    </div>
  </div>
  <footer>
    <p>¬© 2025 Daytona - Todos los derechos reservados
      <a href="https://www.instagram.com/daytona_clean_service" target="_blank" title="Instagram Daytona">
        <i class="fab fa-instagram fa-lg"></i> @daytona_clean_service
      </a>
    </p>
  </footer>

  <!-- Modal de Confirmaci√≥n -->
  <div class="modal fade" id="confirmacionModal" tabindex="-1" aria-labelledby="confirmacionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="confirmacionModalLabel">
            <i class="fas fa-check-circle me-2"></i>¬°Turno Confirmado!
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="confirmacionMensaje"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" data-bs-dismiss="modal">Aceptar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Error -->
  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="errorModalLabel">
            <i class="fas fa-exclamation-triangle me-2"></i>Error
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="errorMensaje"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Aceptar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS debe ir primero para que los dropdowns funcionen -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/api-service.js"></script>
  <script src="js/include-header.js"></script>
  <script src="js/include-footer.js"></script>
  <script>
  // Verificar que la API est√© disponible
  console.log('üîç Verificando disponibilidad de la API...');
  if (window.apiService) {
    console.log('‚úÖ API Service disponible');
  } else {
    console.log('‚ùå API Service no disponible');
  }

  // Funci√≥n de prueba para verificar el guardado en historial
  window.testGuardadoHistorial = async function() {
    console.log('üß™ Iniciando prueba de guardado en historial...');
    
    // Simular datos de un turno
    const turnoPrueba = {
      nombre: 'Juan',
      apellido: 'P√©rez',
      telefono: '3482123456',
      email: 'juan@test.com'
    };
    
    const turnosSeparadosPrueba = {
      vehiculos: {
        servicios: [
          {
            nombre: 'Lavado de Auto',
            cantidad: 1,
            precio: 20000,
            duracion: 60
          }
        ],
        fecha: '2024-12-20',
        hora: '10:00',
        direccion: 'Av. San Mart√≠n 123',
        detalles: 'Test de guardado'
      },
      tapizados: {
        servicios: [],
        fecha: null,
        hora: null,
        direccion: null,
        detalles: null
      }
    };
    
    // Guardar temporalmente los datos reales
    const turnoOriginal = window.turno;
    const turnosSeparadosOriginal = window.turnosSeparados;
    
    // Usar datos de prueba
    window.turno = turnoPrueba;
    window.turnosSeparados = turnosSeparadosPrueba;
    
    try {
      console.log('üì§ Enviando turno de prueba...');
      const resultado = await window.guardarTurnoEnHistorial();
      console.log('üìã Resultado:', resultado);
      console.log('‚úÖ Prueba completada exitosamente');
    } catch (error) {
      console.error('‚ùå Error en la prueba:', error);
    } finally {
      // Restaurar datos originales
      window.turno = turnoOriginal;
      window.turnosSeparados = turnosSeparadosOriginal;
    }
  };
  
  console.log('üß™ Para probar el guardado, ejecuta: testGuardadoHistorial()');
  
  // Funci√≥n para probar auto-completado de datos
  window.testAutoCompletado = function() {
    console.log('üß™ Probando auto-completado de datos...');
    
    // Simular datos de usuario (como se guardan realmente)
    const userData = {
      id: 1,
      name: 'Juan P√©rez', // Nombre completo como se guarda en el registro
      email: 'juan@test.com',
      phone: '3482123456', // Agregar tel√©fono para probar
      role: 'user'
    };
    
    // Guardar en localStorage
    localStorage.setItem('token', 'test-token');
    localStorage.setItem('userData', JSON.stringify(userData));
    
    console.log('‚úÖ Datos de prueba guardados:', userData);
    console.log('üîÑ Ahora ve al paso 4 para ver el auto-completado');
    console.log('üìù El nombre "Juan P√©rez" se separar√° en: Nombre="Juan", Apellido="P√©rez"');
    console.log('üìû El tel√©fono "3482123456" deber√≠a autocompletarse');
  };
  
  console.log('üß™ Para probar auto-completado, ejecuta: testAutoCompletado()');
  
  // Funci√≥n para limpiar datos de prueba
  window.limpiarDatosPrueba = function() {
    console.log('üßπ Limpiando datos de prueba...');
    localStorage.removeItem('token');
    localStorage.removeItem('userData');
    console.log('‚úÖ Datos de prueba eliminados');
    console.log('üîÑ Recarga la p√°gina para ver el estado sin login');
  };
  
  console.log('üßπ Para limpiar datos de prueba, ejecuta: limpiarDatosPrueba()');
  
  // Funci√≥n para verificar datos del usuario actual
  window.verificarDatosUsuario = function() {
    console.log('üîç Verificando datos del usuario actual...');
    const token = localStorage.getItem('token');
    const userData = localStorage.getItem('userData');
    
    console.log('Token:', token ? 'Presente' : 'Ausente');
    console.log('UserData:', userData);
    
    if (userData) {
      try {
        const user = JSON.parse(userData);
        console.log('üë§ Datos del usuario:', user);
        console.log('üìû Tel√©fono disponible:', user.phone || user.telefono || user.phonenumber || user.celular || user.phoneNumber || 'NO ENCONTRADO');
      } catch (error) {
        console.error('‚ùå Error parseando userData:', error);
      }
    }
  };
  
  console.log('üîç Para verificar datos del usuario actual, ejecuta: verificarDatosUsuario()');
  
  // Funci√≥n para agregar tel√©fono al usuario actual (para pruebas)
  window.agregarTelefonoUsuario = function(telefono) {
    console.log('üìû Agregando tel√©fono al usuario actual...');
    const userData = localStorage.getItem('userData');
    
    if (userData) {
      try {
        const user = JSON.parse(userData);
        user.phone = telefono;
        localStorage.setItem('userData', JSON.stringify(user));
        console.log('‚úÖ Tel√©fono agregado:', telefono);
        console.log('üîÑ Recarga la p√°gina para que tome efecto');
      } catch (error) {
        console.error('‚ùå Error actualizando userData:', error);
      }
    } else {
      console.error('‚ùå No hay datos de usuario');
    }
  };
  
  console.log('üìû Para agregar tel√©fono al usuario actual, ejecuta: agregarTelefonoUsuario("3482123456")');
  
  // Agregar tel√©fono autom√°ticamente al usuario actual si no lo tiene
  window.agregarTelefonoAutomaticamente = function() {
    console.log('üîß Verificando tel√©fono del usuario...');
    const userData = localStorage.getItem('userData');
    
    if (userData) {
      try {
        const user = JSON.parse(userData);
        if (!user.phone) {
          // No agregar tel√©fono autom√°ticamente, dejar que el usuario lo complete
          console.log('‚ÑπÔ∏è El usuario no tiene tel√©fono guardado. Deber√° completarlo manualmente.');
          return false;
        } else {
          console.log('‚ÑπÔ∏è El usuario ya tiene tel√©fono:', user.phone);
          return true;
        }
      } catch (error) {
        console.error('‚ùå Error verificando userData:', error);
        return false;
      }
    } else {
      console.error('‚ùå No hay datos de usuario');
      return false;
    }
  };
  
  console.log('üîß Para agregar tel√©fono autom√°ticamente, ejecuta: agregarTelefonoAutomaticamente()');
  
  // Funci√≥n para obtener el tel√©fono real del usuario desde el backend
  window.obtenerTelefonoReal = async function() {
    console.log('üìû Obteniendo tel√©fono real del usuario...');
    const token = localStorage.getItem('token');
    
    if (!token) {
      console.error('‚ùå No hay token de autenticaci√≥n');
      return null;
    }
    
    try {
      // Primero intentar obtener del localStorage (pero verificar que no sea el gen√©rico)
      const userData = localStorage.getItem('userData');
      if (userData) {
        const user = JSON.parse(userData);
        if (user.phone && user.phone !== '3482123456') {
          console.log('‚úÖ Tel√©fono encontrado en localStorage:', user.phone);
          return user.phone;
        }
      }
      
      // Si no est√° en localStorage o es gen√©rico, intentar obtener del backend
      console.log('üîÑ Buscando tel√©fono en el backend...');
      const response = await fetch(`${window.getApiUrl ? window.getApiUrl() : 'https://daytona-clean-service.onrender.com/api'}/users/me`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        if (data.success && data.user && data.user.phone) {
          console.log('‚úÖ Tel√©fono obtenido del backend:', data.user.phone);
          // Actualizar localStorage con el tel√©fono real
          if (userData) {
            const user = JSON.parse(userData);
            user.phone = data.user.phone;
            localStorage.setItem('userData', JSON.stringify(user));
            console.log('‚úÖ localStorage actualizado con tel√©fono real');
          }
          return data.user.phone;
        }
      }
      
      console.log('‚ÑπÔ∏è No se encontr√≥ tel√©fono guardado');
      return null;
    } catch (error) {
      console.error('‚ùå Error obteniendo tel√©fono:', error);
      return null;
    }
  };
  
  console.log('üìû Para obtener tel√©fono real, ejecuta: obtenerTelefonoReal()');
  
  // Funci√≥n para limpiar el tel√©fono gen√©rico y usar el real
  window.limpiarTelefonoGenerico = function() {
    console.log('üßπ Limpiando tel√©fono gen√©rico...');
    const userData = localStorage.getItem('userData');
    
    if (userData) {
      try {
        const user = JSON.parse(userData);
        if (user.phone === '3482123456') {
          // Eliminar el tel√©fono gen√©rico
          delete user.phone;
          localStorage.setItem('userData', JSON.stringify(user));
          console.log('‚úÖ Tel√©fono gen√©rico eliminado');
          console.log('üîÑ Recarga la p√°gina para que tome efecto');
          return true;
        } else {
          console.log('‚ÑπÔ∏è No hay tel√©fono gen√©rico para limpiar');
          return false;
        }
      } catch (error) {
        console.error('‚ùå Error limpiando tel√©fono:', error);
        return false;
      }
    } else {
      console.error('‚ùå No hay datos de usuario');
      return false;
    }
  };
  
  console.log('üßπ Para limpiar tel√©fono gen√©rico, ejecuta: limpiarTelefonoGenerico()');
  
  // Funci√≥n para forzar la actualizaci√≥n del tel√©fono desde el backend
  window.actualizarTelefonoDesdeBackend = async function() {
    console.log('üîÑ Forzando actualizaci√≥n del tel√©fono desde el backend...');
    const telefono = await obtenerTelefonoReal();
    if (telefono) {
      console.log('‚úÖ Tel√©fono actualizado:', telefono);
      console.log('üîÑ Recarga la p√°gina para ver el cambio en el formulario');
      return telefono;
    } else {
      console.log('‚ùå No se pudo obtener el tel√©fono del backend');
      return null;
    }
  };
  
  console.log('üîÑ Para forzar actualizaci√≥n del tel√©fono, ejecuta: actualizarTelefonoDesdeBackend()');
  


  // Variables globales para servicios
  let sillonesAgregados = [];
  let sillasAgregadas = [];
  let colchonesAgregados = [];
  let vehiculosAgregados = [];
  let tapizadoVehiculosAgregados = [];
  let motoresAgregados = [];
  let alfombrasAgregadas = [];
  let puffsAgregados = [];

  // Variables para manejar turnos separados (hacerlas globales)
  window.turnosSeparados = {
    vehiculos: {
      servicios: [],
      fecha: null,
      hora: null,
      direccion: null,
      detalles: null
    },
    tapizados: {
      servicios: [],
      fecha: null,
      hora: null,
      direccion: null,
      detalles: null
    }
  };

  // Variables globales para servicios
  let serviciosBD = [];
  let serviciosPorCategoria = {};

  // Cargar servicios desde la base de datos
  async function cargarServiciosDesdeBD() {
    try {
      const response = await fetch('/api/appointments/services');
      const data = await response.json();
      
      if (data.success) {
        serviciosBD = data.services;
        
        // Organizar servicios por categor√≠a
        serviciosPorCategoria = {};
        serviciosBD.forEach(servicio => {
          if (!serviciosPorCategoria[servicio.category]) {
            serviciosPorCategoria[servicio.category] = [];
          }
          serviciosPorCategoria[servicio.category].push(servicio);
        });
        
        console.log('‚úÖ Servicios cargados desde BD:', serviciosBD.length, 'servicios');
        console.log('üìÇ Categor√≠as disponibles:', Object.keys(serviciosPorCategoria));
      } else {
        console.error('‚ùå Error cargando servicios:', data.message);
      }
    } catch (error) {
      console.error('‚ùå Error en cargarServiciosDesdeBD:', error);
    }
  }

  // Funci√≥n para obtener precio desde BD por nombre y tipo
  function getPrecioDesdeBD(nombreServicio, tipo = null) {
    const servicio = serviciosBD.find(s => {
      if (tipo) {
        return s.name.toLowerCase().includes(nombreServicio.toLowerCase()) && 
               s.name.toLowerCase().includes(tipo.toLowerCase());
      }
      return s.name.toLowerCase().includes(nombreServicio.toLowerCase());
    });
    
    return servicio ? servicio.price : 0;
  }

  // Funciones helper para obtener precios (solo desde BD)
  function getPrecioVehiculo(tipo) {
    return getPrecioDesdeBD('veh√≠culo', tipo);
  }

  function getPrecioTapizadoVehiculo(tipo) {
    return getPrecioDesdeBD('tapizado veh√≠culo', tipo);
  }

  function getPrecioMotor(tipo) {
    return getPrecioDesdeBD('motor', tipo);
  }

  function getPrecioSillon(tipo) {
    return getPrecioDesdeBD('sill√≥n', tipo);
  }

  function getPrecioSilla(tipo) {
    return getPrecioDesdeBD('silla', tipo);
  }

  function getPrecioColchon(tipo) {
    return getPrecioDesdeBD('colch√≥n', tipo);
  }

  function getPrecioAlfombra(tipo) {
    return getPrecioDesdeBD('alfombra', tipo);
  }

  function getPrecioPuff(tipo) {
    return getPrecioDesdeBD('puff', tipo);
  }

  // Cargar servicios al iniciar la p√°gina
  document.addEventListener('DOMContentLoaded', function() {
    cargarServiciosDesdeBD();
  });

  // Funci√≥n para categorizar servicios
  function categorizarServicios() {
    const serviciosVehiculos = [];
    const serviciosTapizados = [];
    
    // Categorizar veh√≠culos
    vehiculosAgregados.forEach(vehiculo => {
      serviciosVehiculos.push({
        service_id: vehiculo.service_id,
        nombre: vehiculo.nombre,
        cantidad: vehiculo.cantidad,
        precio: vehiculo.precio,
        duracion: 180
      });
    });
    
    // Categorizar tapizado de veh√≠culos
    tapizadoVehiculosAgregados.forEach(tv => {
      serviciosVehiculos.push({
        service_id: tv.service_id,
        nombre: tv.nombre,
        cantidad: tv.cantidad,
        precio: tv.precio,
        duracion: 120
      });
    });
    
    // Categorizar motores
    motoresAgregados.forEach(motor => {
      serviciosVehiculos.push({
        service_id: motor.service_id,
        nombre: motor.nombre,
        cantidad: motor.cantidad,
        precio: motor.precio,
        duracion: 45
      });
    });
    
    // Categorizar sillones
    sillonesAgregados.forEach(sillon => {
      serviciosTapizados.push({
        service_id: sillon.service_id,
        nombre: sillon.nombre,
        cantidad: sillon.cantidad,
        precio: sillon.precio,
        duracion: 80
      });
    });
    
    // Categorizar sillas
    sillasAgregadas.forEach(silla => {
      serviciosTapizados.push({
        service_id: silla.service_id,
        nombre: silla.nombre,
        cantidad: silla.cantidad,
        precio: silla.precio,
        duracion: 40
      });
    });
    
    // Categorizar colchones
    colchonesAgregados.forEach(colchon => {
      serviciosTapizados.push({
        service_id: colchon.service_id,
        nombre: colchon.nombre,
        cantidad: colchon.cantidad,
        precio: colchon.precio,
        duracion: 60
      });
    });
    
    // Categorizar alfombras
    alfombrasAgregadas.forEach(alfombra => {
      serviciosTapizados.push({
        service_id: alfombra.service_id,
        nombre: alfombra.nombre,
        cantidad: alfombra.cantidad,
        precio: alfombra.precio,
        duracion: 120
      });
    });
    
    // Categorizar puffs
    puffsAgregados.forEach(puff => {
      serviciosTapizados.push({
        service_id: puff.service_id,
        nombre: puff.nombre,
        cantidad: puff.cantidad,
        precio: puff.precio,
        duracion: 60
      });
    });
    
    turnosSeparados.vehiculos.servicios = serviciosVehiculos;
    turnosSeparados.tapizados.servicios = serviciosTapizados;
    
    return {
      hayVehiculos: serviciosVehiculos.length > 0,
      hayTapizados: serviciosTapizados.length > 0,
      necesitaTurnosSeparados: serviciosVehiculos.length > 0 && serviciosTapizados.length > 0
    };
  }

  // Funciones globales para sillones (usando service_id)
  function cambiarCantidad(serviceId, delta) {
    const sillon = sillonesAgregados.find(s => s.service_id == serviceId);
    if (sillon) {
      sillon.cantidad = Math.max(1, sillon.cantidad + delta);
      renderSillonesCards();
    }
  }

  function eliminarSillon(serviceId) {
    const index = sillonesAgregados.findIndex(s => s.service_id == serviceId);
    if (index > -1) {
      sillonesAgregados.splice(index, 1);
      renderSillonesCards();
    }
  }

  // Funciones globales para sillas (usando service_id)
  function cambiarCantidadSilla(serviceId, delta) {
    const silla = sillasAgregadas.find(s => s.service_id == serviceId);
    if (silla) {
      silla.cantidad = Math.max(1, silla.cantidad + delta);
      renderSillasCards();
    }
  }

  function eliminarSilla(serviceId) {
    const index = sillasAgregadas.findIndex(s => s.service_id == serviceId);
    if (index > -1) {
      sillasAgregadas.splice(index, 1);
      renderSillasCards();
    }
  }

  // Funciones globales para colchones (usando service_id)
  function cambiarCantidadColchon(serviceId, delta) {
    const colchon = colchonesAgregados.find(c => c.service_id == serviceId);
    if (colchon) {
      colchon.cantidad = Math.max(1, colchon.cantidad + delta);
      renderColchonesCards();
    }
  }

  function eliminarColchon(serviceId) {
    const index = colchonesAgregados.findIndex(c => c.service_id == serviceId);
    if (index > -1) {
      colchonesAgregados.splice(index, 1);
      renderColchonesCards();
    }
  }

  // Funciones globales para veh√≠culos (usando service_id)
  function cambiarCantidadVehiculo(serviceId, delta) {
    const vehiculo = vehiculosAgregados.find(v => v.service_id == serviceId);
    if (vehiculo) {
      vehiculo.cantidad = Math.max(1, vehiculo.cantidad + delta);
      renderVehiculosCards();
    }
  }

  function eliminarVehiculo(serviceId) {
    const index = vehiculosAgregados.findIndex(v => v.service_id == serviceId);
    if (index > -1) {
      vehiculosAgregados.splice(index, 1);
      renderVehiculosCards();
    }
  }

  // Funciones globales para tapizado de veh√≠culos (usando service_id)
  function cambiarCantidadTapizadoVehiculo(serviceId, delta) {
    const tv = tapizadoVehiculosAgregados.find(tv => tv.service_id == serviceId);
    if (tv) {
      tv.cantidad = Math.max(1, tv.cantidad + delta);
      renderTapizadoVehiculosCards();
    }
  }

  function eliminarTapizadoVehiculo(serviceId) {
    const index = tapizadoVehiculosAgregados.findIndex(tv => tv.service_id == serviceId);
    if (index > -1) {
      tapizadoVehiculosAgregados.splice(index, 1);
      renderTapizadoVehiculosCards();
    }
  }

  // Funciones globales para motores (usando service_id)
  function cambiarCantidadMotor(serviceId, delta) {
    const motor = motoresAgregados.find(m => m.service_id == serviceId);
    if (motor) {
      motor.cantidad = Math.max(1, motor.cantidad + delta);
      renderMotoresCards();
    }
  }

  function eliminarMotor(serviceId) {
    const index = motoresAgregados.findIndex(m => m.service_id == serviceId);
    if (index > -1) {
      motoresAgregados.splice(index, 1);
      renderMotoresCards();
    }
  }

  // Funciones globales para alfombras (usando service_id)
  function cambiarCantidadAlfombra(serviceId, delta) {
    const alfombra = alfombrasAgregadas.find(a => a.service_id == serviceId);
    if (alfombra) {
      alfombra.cantidad = Math.max(1, alfombra.cantidad + delta);
      renderAlfombrasCards();
    }
  }

  function eliminarAlfombra(serviceId) {
    const index = alfombrasAgregadas.findIndex(a => a.service_id == serviceId);
    if (index > -1) {
      alfombrasAgregadas.splice(index, 1);
      renderAlfombrasCards();
    }
  }

  // Funciones globales para puffs (usando service_id)
  function cambiarCantidadPuff(serviceId, delta) {
    const puff = puffsAgregados.find(p => p.service_id == serviceId);
    if (puff) {
      puff.cantidad = Math.max(1, puff.cantidad + delta);
      renderPuffsCards();
    }
  }

  function eliminarPuff(serviceId) {
    const index = puffsAgregados.findIndex(p => p.service_id == serviceId);
    if (index > -1) {
      puffsAgregados.splice(index, 1);
      renderPuffsCards();
    }
  }

  // Funciones de renderizado para sillones
  function renderSillonesCards() {
    console.log('renderSillonesCards llamado');
    console.log('sillonesAgregados:', sillonesAgregados);
    const sillonesSeleccionados = document.getElementById('sillones-seleccionados');
    console.log('Elemento sillones-seleccionados:', sillonesSeleccionados);
    sillonesSeleccionados.innerHTML = '';
    
    sillonesAgregados.forEach(sillon => {
      console.log('Renderizando sillon:', sillon);
      const precioUnitario = getPrecioPorId(sillon.service_id);
      const precioTotal = precioUnitario * sillon.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-couch me-2"></i><strong>${sillon.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">80 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarSillon('${sillon.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidad('${sillon.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${sillon.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidad('${sillon.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      sillonesSeleccionados.appendChild(card);
      console.log('Card agregada al DOM');
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (sillonesAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalSillones() {
    const totalSpan = document.getElementById('sillones-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para sillas
  function renderSillasCards() {
    const sillasSeleccionadas = document.getElementById('sillas-seleccionadas');
    sillasSeleccionadas.innerHTML = '';
    
    sillasAgregadas.forEach(silla => {
      const precioUnitario = getPrecioPorId(silla.service_id);
      const precioTotal = precioUnitario * silla.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-chair me-2"></i><strong>${silla.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">60 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarSilla('${silla.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadSilla('${silla.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${silla.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadSilla('${silla.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      sillasSeleccionadas.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (sillasAgregadas.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalSillas() {
    const totalSpan = document.getElementById('sillas-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para colchones
  function renderColchonesCards() {
    const colchonesSeleccionados = document.getElementById('colchones-seleccionados');
    colchonesSeleccionados.innerHTML = '';
    
    colchonesAgregados.forEach(colchon => {
      const precioUnitario = getPrecioPorId(colchon.service_id);
      const precioTotal = precioUnitario * colchon.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-bed me-2"></i><strong>${colchon.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">90 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarColchon('${colchon.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadColchon('${colchon.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${colchon.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadColchon('${colchon.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      colchonesSeleccionados.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (colchonesAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalColchones() {
    const totalSpan = document.getElementById('colchones-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para veh√≠culos
  function renderVehiculosCards() {
    const vehiculosSeleccionados = document.getElementById('vehiculos-seleccionados');
    vehiculosSeleccionados.innerHTML = '';
    
    vehiculosAgregados.forEach(vehiculo => {
      const precioUnitario = getPrecioPorId(vehiculo.service_id);
      const precioTotal = precioUnitario * vehiculo.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-car me-2"></i><strong>${vehiculo.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">90 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarVehiculo('${vehiculo.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadVehiculo('${vehiculo.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${vehiculo.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadVehiculo('${vehiculo.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      vehiculosSeleccionados.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (vehiculosAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalVehiculos() {
    const totalSpan = document.getElementById('vehiculos-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para motores
  function renderMotoresCards() {
    const motoresSeleccionados = document.getElementById('motores-seleccionados');
    motoresSeleccionados.innerHTML = '';
    
    motoresAgregados.forEach(motor => {
      const precioUnitario = getPrecioPorId(motor.service_id);
      const precioTotal = precioUnitario * motor.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-gears me-2"></i><strong>${motor.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">45 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarMotor('${motor.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadMotor('${motor.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${motor.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadMotor('${motor.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      motoresSeleccionados.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (motoresAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalMotores() {
    const totalSpan = document.getElementById('motores-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para alfombras
  function renderAlfombrasCards() {
    const alfombrasSeleccionadas = document.getElementById('alfombras-seleccionadas');
    alfombrasSeleccionadas.innerHTML = '';
    
    alfombrasAgregadas.forEach(alfombra => {
      const precioUnitario = getPrecioPorId(alfombra.service_id);
      const precioTotal = precioUnitario * alfombra.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-rug me-2"></i><strong>${alfombra.nombre}</strong>
              <span class="badge bg-dark text-warning ms-2">120 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarAlfombra('${alfombra.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadAlfombra('${alfombra.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${alfombra.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadAlfombra('${alfombra.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      alfombrasSeleccionadas.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (alfombrasAgregadas.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalAlfombras() {
    const totalSpan = document.getElementById('alfombras-total');
    if (alfombrasAgregadas.length > 0) {
      const precios = {
        'chica': 20000,
        'mediana': 25000,
        'grande': 30000,
        'persa': 35000
      };
      let total = 0;
      alfombrasAgregadas.forEach(alfombra => {
        total += precios[alfombra.tipo] * alfombra.cantidad;
      });
      totalSpan.innerHTML = `<div class="p-2 rounded bg-danger text-white"><i class="fas fa-rug me-1"></i>Total Alfombras: $${total.toLocaleString('es-AR')}</div>`;
    } else {
      totalSpan.innerHTML = '';
    }
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para puffs
  function renderPuffsCards() {
    const puffsSeleccionados = document.getElementById('puffs-seleccionados');
    puffsSeleccionados.innerHTML = '';
    
    puffsAgregados.forEach(puff => {
      const precioUnitario = getPrecioPorId(puff.service_id);
      const precioTotal = precioUnitario * puff.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-couch me-2"></i><strong>${puff.nombre}</strong>
              <span class="badge bg-dark text-white ms-2">60 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarPuff('${puff.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadPuff('${puff.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${puff.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadPuff('${puff.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      puffsSeleccionados.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (puffsAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalPuffs() {
    const totalSpan = document.getElementById('puffs-total');
    if (puffsAgregados.length > 0) {
      const precios = {
        'simple': 10500,
        'grande': 15000,
        'especial': 20000
      };
      let total = 0;
      puffsAgregados.forEach(puff => {
        total += precios[puff.tipo] * puff.cantidad;
      });
      totalSpan.innerHTML = `<div class="p-2 rounded bg-danger text-white"><i class="fas fa-couch me-1"></i>Total Puffs: $${total.toLocaleString('es-AR')}</div>`;
    } else {
      totalSpan.innerHTML = '';
    }
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funciones de renderizado para tapizado de veh√≠culos
  function renderTapizadoVehiculosCards() {
    const tapizadovehiculosSeleccionados = document.getElementById('tapizadovehiculos-seleccionados');
    tapizadovehiculosSeleccionados.innerHTML = '';
    
    tapizadoVehiculosAgregados.forEach(tv => {
      const precioUnitario = getPrecioPorId(tv.service_id);
      const precioTotal = precioUnitario * tv.cantidad;
      
      const card = document.createElement('div');
      card.className = 'mb-3';
      card.innerHTML = `
        <div class="p-3 rounded bg-dark text-light position-relative">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <i class="fas fa-car-side me-2"></i><strong>${tv.nombre}</strong>
              <span class="badge bg-dark text-warning ms-2">120 min</span>
            </div>
            <button type="button" class="btn btn-sm btn-outline-danger" onclick="eliminarTapizadoVehiculo('${tv.service_id}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-white">$${precioUnitario.toLocaleString('es-AR')} c/u</span>
            <div class="d-flex align-items-center">
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadTapizadoVehiculo('${tv.service_id}', -1)">
                <i class="fas fa-minus"></i>
              </button>
              <span class="mx-3 fw-bold">${tv.cantidad}</span>
              <button type="button" class="btn btn-sm btn-outline-light" onclick="cambiarCantidadTapizadoVehiculo('${tv.service_id}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div class="text-white mt-2">
            <strong>Subtotal: $${precioTotal.toLocaleString('es-AR')}</strong>
          </div>
        </div>
      `;
      tapizadovehiculosSeleccionados.appendChild(card);
    });
    // Habilitar/deshabilitar bot√≥n siguiente
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (tapizadoVehiculosAgregados.length > 0) {
      btnSiguiente.disabled = false;
    } else {
      btnSiguiente.disabled = true;
    }
  }

  function actualizarTotalTapizadoVehiculos() {
    const totalSpan = document.getElementById('tapizadovehiculos-total');
    totalSpan.innerHTML = '';
    actualizarResumenFinal();
    categorizarServicios(); // Actualizar categorizaci√≥n
  }

  // Funci√≥n para actualizar el resumen final usando precios reales de la BD
  function actualizarResumenFinal() {
    const resumenFinal = document.getElementById('resumen-final');
    const listaServicios = document.getElementById('lista-servicios');
    const totalGeneral = document.getElementById('total-general');
    
    // Verificar que los elementos existen
    if (!resumenFinal || !listaServicios || !totalGeneral) {
      console.warn('‚ö†Ô∏è Elementos del resumen no encontrados');
      return;
    }
    
    // Recolectar todos los servicios usando precios reales de la BD
    let todosLosServicios = [];
    let totalGeneralCalculado = 0;
    
    // Funci√≥n helper para agregar servicios con precio real
    function agregarServiciosConPrecioReal(arrayServicios, icon) {
      arrayServicios.forEach(servicio => {
        const precioReal = getPrecioPorId(servicio.service_id);
        const subtotal = precioReal * servicio.cantidad;
        todosLosServicios.push({
          nombre: servicio.nombre,
          cantidad: servicio.cantidad,
          precio: precioReal,
          subtotal: subtotal,
          icon: icon
        });
        totalGeneralCalculado += subtotal;
      });
    }
    
    // Agregar todos los tipos de servicios usando precios reales
    agregarServiciosConPrecioReal(sillonesAgregados, 'fa-couch');
    agregarServiciosConPrecioReal(sillasAgregadas, 'fa-chair');
    agregarServiciosConPrecioReal(colchonesAgregados, 'fa-bed');
    agregarServiciosConPrecioReal(vehiculosAgregados, 'fa-car');
    agregarServiciosConPrecioReal(motoresAgregados, 'fa-gears');
    agregarServiciosConPrecioReal(alfombrasAgregadas, 'fa-rug');
    agregarServiciosConPrecioReal(puffsAgregados, 'fa-couch');
    agregarServiciosConPrecioReal(tapizadoVehiculosAgregados, 'fa-car-side');
    
    // Mostrar u ocultar el resumen
    if (todosLosServicios.length > 0) {
      resumenFinal.style.display = 'block';
      
      // Generar la lista de servicios
      listaServicios.innerHTML = '';
      todosLosServicios.forEach(servicio => {
        const item = document.createElement('div');
        item.className = 'd-flex justify-content-between align-items-center mb-2';
        item.innerHTML = `
          <div class="d-flex align-items-center">
            <i class="fas ${servicio.icon} me-2 text-white"></i>
            <span class="text-white">${servicio.nombre} x${servicio.cantidad}</span>
          </div>
          <div class="text-end">
            <div class="text-white small">$${servicio.precio.toLocaleString('es-AR')} c/u</div>
            <div class="fw-bold text-white">$${servicio.subtotal.toLocaleString('es-AR')}</div>
          </div>
        `;
        listaServicios.appendChild(item);
      });
      
      // Actualizar total general
      totalGeneral.textContent = `$${totalGeneralCalculado.toLocaleString('es-AR')}`;
    } else {
      resumenFinal.style.display = 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Limpiar tel√©fono gen√©rico y obtener el real
    setTimeout(() => {
      limpiarTelefonoGenerico();
      agregarTelefonoAutomaticamente();
    }, 1000);
    
    // Wizard navigation logic
    let step = 1;
    let turno = {
      servicio: null,
      duracion: null,
      precio: null,
      profesional: 'Benjam√≠n Gianneschi',
      fecha: null,
      hora: null,
      nombre: null,
      apellido: null,
      telefono: null,
      email: null,
      ubicacion: null,
      tipoServicio: null,
      retiroEntrega: null,
      direccionRetiro: null,
      direccionEntrega: null,
      direccionDomicilio: null,
      detallesUbicacion: null
    };
    function updateWizardBar(step) {
      const percent = ((step - 1) / 5) * 100;
      document.getElementById('wizard-bar-fill').style.width = percent + '%';
      for (let i = 1; i <= 6; i++) {
        const el = document.getElementById('step-indicator-' + i);
        el.classList.remove('active', 'completed');
        if (i < step) el.classList.add('completed');
        if (i === step) el.classList.add('active');
      }
    }
    function showStep(n) {
      for (let i = 1; i <= 6; i++) {
        const stepDiv = document.getElementById('step-' + i);
        if (stepDiv) stepDiv.style.display = (i === n) ? '' : 'none';
      }
      updateWizardBar(n);
      
      // L√≥gica espec√≠fica para cada paso
      if (n === 3) {
        mostrarTurnosSeparados();
      } else if (n === 4) {
        console.log('üéØ Llegando al paso 4 - Datos Personales');
        autoCompletarDatosUsuario();
      } else if (n === 5) {
        mostrarCamposUbicacion();
      } else if (n === 6) {
        mostrarResumenTurnosSeparados();
      }
    }
    
    function mostrarTurnosSeparados() {
      const categorias = categorizarServicios();
      
      // Ocultar todos los contenedores
      document.getElementById('turno-vehiculos').style.display = 'none';
      document.getElementById('turno-tapizados').style.display = 'none';
      document.getElementById('turno-unico').style.display = 'none';
      document.getElementById('info-turnos-separados').style.display = 'none';
      
      if (categorias.necesitaTurnosSeparados) {
        // Mostrar turnos separados
        document.getElementById('info-turnos-separados').style.display = 'block';
        document.getElementById('turno-vehiculos').style.display = 'block';
        document.getElementById('turno-tapizados').style.display = 'block';
        
        // Mostrar resumen de servicios
        mostrarResumenServiciosVehiculos();
        mostrarResumenServiciosTapizados();
      } else if (categorias.hayVehiculos) {
        // Solo servicios de veh√≠culos
        document.getElementById('turno-vehiculos').style.display = 'block';
        mostrarResumenServiciosVehiculos();
      } else if (categorias.hayTapizados) {
        // Solo servicios de tapizados
        document.getElementById('turno-tapizados').style.display = 'block';
        mostrarResumenServiciosTapizados();
      } else {
        // Turno √∫nico (fallback)
        document.getElementById('turno-unico').style.display = 'block';
      }
    }
    
    function mostrarResumenServiciosVehiculos() {
      const container = document.getElementById('servicios-vehiculos-resumen');
      const servicios = turnosSeparados.vehiculos.servicios;
      
      if (servicios.length === 0) {
        container.innerHTML = '<div class="text-muted">No hay servicios de veh√≠culos seleccionados.</div>';
        return;
      }
      
      let html = '<div class="mb-3"><strong>Servicios seleccionados:</strong></div>';
      let total = 0;
      
      servicios.forEach(servicio => {
        const subtotal = servicio.precio * servicio.cantidad;
        total += subtotal;
        html += `
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>${servicio.nombre} x${servicio.cantidad}</span>
            <span class="fw-bold">$${subtotal.toLocaleString('es-AR')}</span>
          </div>
        `;
      });
      
      html += `<hr><div class="d-flex justify-content-between align-items-center"><strong>Total:</strong> <strong class="text-danger">$${total.toLocaleString('es-AR')}</strong></div>`;
      container.innerHTML = html;
    }
    
    function mostrarResumenServiciosTapizados() {
      const container = document.getElementById('servicios-tapizados-resumen');
      const servicios = turnosSeparados.tapizados.servicios;
      
      if (servicios.length === 0) {
        container.innerHTML = '<div class="text-muted">No hay servicios de tapizados seleccionados.</div>';
        return;
      }
      
      let html = '<div class="mb-3"><strong>Servicios seleccionados:</strong></div>';
      let total = 0;
      
      servicios.forEach(servicio => {
        const subtotal = servicio.precio * servicio.cantidad;
        total += subtotal;
        html += `
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>${servicio.nombre} x${servicio.cantidad}</span>
            <span class="fw-bold">$${subtotal.toLocaleString('es-AR')}</span>
          </div>
        `;
      });
      
      html += `<hr><div class="d-flex justify-content-between align-items-center"><strong>Total:</strong> <strong class="text-danger">$${total.toLocaleString('es-AR')}</strong></div>`;
      container.innerHTML = html;
    }
    // Inicializar barra al cargar
    updateWizardBar(step);
    // Dropdown de servicios con iconos y detalles
    const servicios = {
      'Limpieza de Veh√≠culo': {
        icon: 'fa-car',
        duracion: 180,
        precio: 15000,
        desc: 'Interior y exterior, aspirado, vidrios, superficies. Servicio en taller o a domicilio.',
        tipo: 'vehiculo',
        domicilio: true,
        taller: true
      },
      'Limpieza de Tapizado de Veh√≠culo': {
        icon: 'fa-car-side',
        duracion: 120,
        precio: 20000,
        desc: 'Limpieza profunda de asientos, tapizados y alfombras del veh√≠culo. Servicio en taller o a domicilio.',
        tipo: 'vehiculo',
        domicilio: true,
        taller: true
      },
      'Limpieza de Motor': {
        icon: 'fa-gears',
        duracion: 45,
        precio: 12000,
        desc: 'Desengrasado y limpieza segura. Servicio en taller o a domicilio.',
        tipo: 'vehiculo',
        domicilio: true,
        taller: true
      },
      'Limpieza de Colchones': {
        icon: 'fa-bed',
        duracion: 60,
        precio: 12000,
        desc: 'Limpieza profunda y desinfecci√≥n de colchones, elimina √°caros y manchas. Servicio a domicilio.',
        tipo: 'domicilio',
        domicilio: true,
        taller: false
      },
      'Limpieza de Sillones': {
        icon: 'fa-couch',
        duracion: 80,
        precio: 18000,
        desc: 'Limpieza y desmanchado de sillones de tela, cuero o ecocuero. Servicio a domicilio.',
        tipo: 'domicilio',
        domicilio: true,
        taller: false
      },
      'Limpieza de Sillas': {
        icon: 'fa-chair',
        duracion: 40,
        precio: 7000,
        desc: 'Limpieza y desinfecci√≥n de sillas tapizadas, ideal para hogar y oficina. Servicio a domicilio.',
        tipo: 'domicilio',
        domicilio: true,
        taller: false
      },
      'Limpieza de Alfombras': {
        icon: 'fa-rug',
        duracion: 120,
        precio: 20000,
        desc: 'Limpieza profunda de alfombras con equipos de inyecci√≥n y extracci√≥n profesional. Servicio a domicilio.',
        tipo: 'domicilio',
        domicilio: true,
        taller: false
      },
      'Limpieza de Puff': {
        icon: 'fa-couch',
        duracion: 60,
        precio: 10500,
        desc: 'Limpieza y desinfecci√≥n profunda de puffs tapizados. Eliminamos manchas, suciedad y √°caros. Servicio a domicilio.',
        tipo: 'domicilio',
        domicilio: true,
        taller: false
      }
    };
    const selectServicio = document.getElementById('servicio-select');
    const detalleServicio = document.getElementById('servicio-detalle');
    const sillonesOpciones = document.getElementById('sillones-opciones');
    
    // Funci√≥n para auto-completar datos del usuario logueado
    async function autoCompletarDatosUsuario() {
      const token = localStorage.getItem('token');
      const userData = localStorage.getItem('userData');
      
      console.log('üîç Verificando datos de usuario...');
      console.log('Token:', token ? 'Presente' : 'Ausente');
      console.log('UserData:', userData);
      
      if (token && userData) {
        try {
          const user = JSON.parse(userData);
          console.log('üë§ Datos del usuario parseados:', user);
          
          // Mostrar mensaje de bienvenida
          document.getElementById('usuario-logueado-info').style.display = 'block';
          
          // Separar nombre completo en nombre y apellido
          let nombre = '';
          let apellido = '';
          
          if (user.name) {
            const nombres = user.name.split(' ');
            nombre = nombres[0] || '';
            apellido = nombres.slice(1).join(' ') || '';
          }
          
          // Buscar tel√©fono en varias propiedades posibles
          let telefono = user.phone || user.telefono || user.phonenumber || user.celular || user.phoneNumber || '';
          
          // Si no hay tel√©fono en localStorage, intentar obtenerlo del backend
          if (!telefono) {
            console.log('üîÑ No hay tel√©fono en localStorage, buscando en el backend...');
            telefono = await obtenerTelefonoReal();
          }
          
          // Auto-completar campos
          document.getElementById('nombre').value = nombre;
          document.getElementById('apellido').value = apellido;
          document.getElementById('telefono').value = telefono;
          document.getElementById('email').value = user.email || '';
          
          // Guardar datos en el objeto turno
          turno.nombre = nombre;
          turno.apellido = apellido;
          turno.telefono = telefono;
          turno.email = user.email || '';
          
          console.log('‚úÖ Datos auto-completados:', {
            nombre: nombre,
            apellido: apellido,
            telefono: telefono,
            email: user.email
          });
          
          // Si no hay tel√©fono, mostrar advertencia
          if (!telefono) {
            console.warn('‚ö†Ô∏è El usuario no tiene tel√©fono guardado. Deber√° completarlo manualmente.');
            document.getElementById('telefono').placeholder = 'Ingresa tu tel√©fono (requerido)';
          }
          
        } catch (error) {
          console.error('‚ùå Error parseando datos de usuario:', error);
          document.getElementById('usuario-logueado-info').style.display = 'none';
        }
      } else {
        // Ocultar mensaje si no est√° logueado
        document.getElementById('usuario-logueado-info').style.display = 'none';
        console.log('‚ÑπÔ∏è Usuario no logueado, no se auto-completan datos');
      }
    }

    // Funci√≥n para guardar turno en el historial (disponible globalmente)
    window.guardarTurnoEnHistorial = async function() {
      const token = localStorage.getItem('token');
      if (!token) {
        console.log('Usuario no logueado, no se guarda en historial');
        return { success: false, message: 'Usuario no logueado' };
      }

      try {
        // Obtener datos del formulario
        const nombre = document.getElementById('nombre')?.value || '';
        const apellido = document.getElementById('apellido')?.value || '';
        const telefono = document.getElementById('telefono')?.value || '';
        const email = document.getElementById('email')?.value || '';

        // Validar que el tel√©fono est√© presente
        if (!telefono || telefono.trim() === '') {
          console.error('‚ùå Error: El tel√©fono es requerido');
          return { success: false, message: 'El tel√©fono es requerido para crear el turno' };
        }

        const categorias = categorizarServicios();
        const turnosParaGuardar = [];
    
        // Preparar datos del turno
        const datosTurno = {
          clientName: `${nombre} ${apellido}`.trim(),
          clientPhone: telefono,
          clientEmail: email,
          status: 'pending',
          notes: 'Turno creado desde el formulario web'
        };

        // Agregar userId si el usuario est√° logueado
        const userData = localStorage.getItem('userData');
        if (userData) {
          const user = JSON.parse(userData);
          datosTurno.userId = user.id;
        }

        if (categorias.necesitaTurnosSeparados) {
          // Guardar turno de veh√≠culos
          if (window.turnosSeparados.vehiculos.servicios.length > 0) {
            const turnoVehiculos = {
              ...datosTurno,
              appointmentDate: window.turnosSeparados.vehiculos.fecha,
              startTime: window.turnosSeparados.vehiculos.hora,
              serviceLocation: window.turnosSeparados.vehiculos.direccion ? 
                (typeof window.turnosSeparados.vehiculos.direccion === 'object' ? 
                  `Retiro: ${window.turnosSeparados.vehiculos.direccion.retiro} | Entrega: ${window.turnosSeparados.vehiculos.direccion.entrega}` : 
                  window.turnosSeparados.vehiculos.direccion) : 'A confirmar',
              services: armarServiciosParaBackend(window.turnosSeparados.vehiculos.servicios),
              totalAmount: window.turnosSeparados.vehiculos.servicios.reduce((sum, s) => sum + (s.precio * s.cantidad), 0)
            };
            turnosParaGuardar.push(turnoVehiculos);
          }

          // Guardar turno de tapizados
          if (window.turnosSeparados.tapizados.servicios.length > 0) {
            const turnoTapizados = {
              ...datosTurno,
              appointmentDate: window.turnosSeparados.tapizados.fecha,
              startTime: window.turnosSeparados.tapizados.hora,
              serviceLocation: window.turnosSeparados.tapizados.direccion || 'A confirmar',
              services: armarServiciosParaBackend(window.turnosSeparados.tapizados.servicios),
              totalAmount: window.turnosSeparados.tapizados.servicios.reduce((sum, s) => sum + (s.precio * s.cantidad), 0)
            };
            turnosParaGuardar.push(turnoTapizados);
          }
        } else {
          // Turno √∫nico
          let servicios = [];
          let fecha = '';
          let hora = '';
          let direccion = '';

          if (categorias.hayVehiculos) {
            servicios = window.turnosSeparados.vehiculos.servicios;
            fecha = window.turnosSeparados.vehiculos.fecha;
            hora = window.turnosSeparados.vehiculos.hora;
            if (window.turnosSeparados.vehiculos.direccion) {
              if (typeof window.turnosSeparados.vehiculos.direccion === 'object') {
                direccion = `Retiro: ${window.turnosSeparados.vehiculos.direccion.retiro} | Entrega: ${window.turnosSeparados.vehiculos.direccion.entrega}`;
              } else {
                direccion = window.turnosSeparados.vehiculos.direccion;
              }
            }
          } else if (categorias.hayTapizados) {
            servicios = window.turnosSeparados.tapizados.servicios;
            fecha = window.turnosSeparados.tapizados.fecha;
            hora = window.turnosSeparados.tapizados.hora;
            direccion = window.turnosSeparados.tapizados.direccion;
          }

          const turnoUnico = {
            ...datosTurno,
            appointmentDate: fecha,
            startTime: hora,
            serviceLocation: direccion || 'A confirmar',
            services: armarServiciosParaBackend(servicios),
            totalAmount: servicios.reduce((sum, s) => sum + (s.precio * s.cantidad), 0)
          };
          turnosParaGuardar.push(turnoUnico);
        }

        // Guardar cada turno en el backend
        const resultados = [];
        for (const turnoData of turnosParaGuardar) {
          try {
            const response = await apiService.createAppointment(turnoData);
            if (response.success) {
              resultados.push({ success: true, data: response.data });
            } else {
              resultados.push({ success: false, message: response.message });
            }
          } catch (error) {
            console.error('Error guardando turno:', error);
            resultados.push({ success: false, message: error.message });
          }
        }

        console.log('üìã Turnos guardados en historial:', resultados);
        return { success: true, data: resultados };

      } catch (error) {
        console.error('Error en guardarTurnoEnHistorial:', error);
        return { success: false, message: error.message };
      }
    }
    
    // Funci√≥n para mostrar campos de ubicaci√≥n seg√∫n el tipo de servicio
    function mostrarCamposUbicacion() {
      const categorias = categorizarServicios();
      
      // Ocultar todos los contenedores
      document.getElementById('ubicacion-vehiculos').style.display = 'none';
      document.getElementById('ubicacion-tapizados').style.display = 'none';
      document.getElementById('ubicacion-unica').style.display = 'none';
      
      if (categorias.necesitaTurnosSeparados) {
        // Mostrar ubicaciones separadas
        mostrarUbicacionVehiculos();
        mostrarUbicacionTapizados();
        document.getElementById('ubicacion-vehiculos').style.display = 'block';
        document.getElementById('ubicacion-tapizados').style.display = 'block';
      } else if (categorias.hayVehiculos) {
        // Solo servicios de veh√≠culos
        mostrarUbicacionVehiculos();
        document.getElementById('ubicacion-vehiculos').style.display = 'block';
      } else if (categorias.hayTapizados) {
        // Solo servicios de tapizados
        mostrarUbicacionTapizados();
        document.getElementById('ubicacion-tapizados').style.display = 'block';
      } else {
        // Ubicaci√≥n √∫nica (fallback)
        document.getElementById('ubicacion-unica').style.display = 'block';
        const ubicacionContainer = document.getElementById('ubicacion-container');
        ubicacionContainer.innerHTML = '<div class="alert alert-warning">No se seleccionaron servicios.</div>';
      }
    }
    
    function mostrarUbicacionVehiculos() {
      const container = document.getElementById('ubicacion-vehiculos-container');
      container.innerHTML = `
        <div class="mb-4">
          <label class="form-label">¬øNecesit√°s retiro y entrega del veh√≠culo?</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="retiro-entrega-vehiculos" id="si-retiro-vehiculos" value="si">
            <label class="form-check-label" for="si-retiro-vehiculos">S√≠, necesito retiro y entrega</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="retiro-entrega-vehiculos" id="no-retiro-vehiculos" value="no" checked>
            <label class="form-check-label" for="no-retiro-vehiculos">No, lo llevo y retiro yo mismo</label>
          </div>
        </div>
        <div class="mb-3" id="direccion-retiro-vehiculos" style="display:none;">
          <label for="direccion-retiro-input-vehiculos" class="form-label">Direcci√≥n de retiro *</label>
          <textarea class="form-control" id="direccion-retiro-input-vehiculos" rows="2" placeholder="Ingresa la direcci√≥n completa donde retirar el veh√≠culo"></textarea>
        </div>
        <div class="mb-3" id="direccion-entrega-vehiculos" style="display:none;">
          <label for="direccion-entrega-input-vehiculos" class="form-label">Direcci√≥n de entrega *</label>
          <textarea class="form-control" id="direccion-entrega-input-vehiculos" rows="2" placeholder="Ingresa la direcci√≥n completa donde entregar el veh√≠culo"></textarea>
        </div>
      `;
      
      // Event listeners para retiro y entrega de veh√≠culos
      const radioSiRetiro = document.getElementById('si-retiro-vehiculos');
      const radioNoRetiro = document.getElementById('no-retiro-vehiculos');
      const direccionRetiro = document.getElementById('direccion-retiro-vehiculos');
      const direccionEntrega = document.getElementById('direccion-entrega-vehiculos');
      
      if (radioSiRetiro && radioNoRetiro) {
        radioSiRetiro.addEventListener('change', function() {
          direccionRetiro.style.display = 'block';
          direccionEntrega.style.display = 'block';
        });
        radioNoRetiro.addEventListener('change', function() {
          direccionRetiro.style.display = 'none';
          direccionEntrega.style.display = 'none';
        });
      }
    }
    
    function mostrarUbicacionTapizados() {
      const container = document.getElementById('ubicacion-tapizados-container');
      container.innerHTML = `
        <div class="alert alert-info" style="background: #232323; color: #fff; border: 1.5px solid #17a2b8;">
          <i class="fas fa-info-circle me-2"></i>
          Este servicio se realiza a domicilio. Por favor, proporciona la direcci√≥n donde se realizar√° el trabajo.
        </div>
        <div class="mb-3">
          <label for="direccion-domicilio-input-tapizados" class="form-label">Direcci√≥n donde se realizar√° el servicio</label>
          <textarea class="form-control" id="direccion-domicilio-input-tapizados" rows="2" placeholder="Ingresa la direcci√≥n completa" required></textarea>
        </div>
      `;
    }
    
    // Funci√≥n para mostrar el resumen de turnos separados
    function mostrarResumenTurnosSeparados() {
      const categorias = categorizarServicios();
      
      // Ocultar todos los contenedores de resumen
      document.getElementById('resumen-turnos-separados').style.display = 'none';
      document.getElementById('resumen-turno-unico').style.display = 'none';
      
      if (categorias.necesitaTurnosSeparados) {
        // Mostrar resumen de turnos separados
        document.getElementById('resumen-turnos-separados').style.display = 'block';
        mostrarResumenTurnoVehiculos();
        mostrarResumenTurnoTapizados();
      } else {
        // Mostrar resumen √∫nico
        document.getElementById('resumen-turno-unico').style.display = 'block';
        mostrarResumenTurnoUnico();
      }
    }
    
    function mostrarResumenTurnoVehiculos() {
      const container = document.getElementById('resumen-turno-vehiculos');
      const servicios = turnosSeparados.vehiculos.servicios;
      
      let html = `
        <div style="background:#232323;border-radius:10px;overflow:hidden;">
          <div style="background:#ff3b3f;color:#fff;padding:10px 18px;font-weight:700;font-size:1.1rem;display:flex;align-items:center;gap:8px;">
            <i class='fas fa-car'></i> Servicios de Veh√≠culos
          </div>
          <div style="padding:18px 18px 10px 18px;">
      `;
      
      let total = 0;
      servicios.forEach(servicio => {
        const subtotal = servicio.precio * servicio.cantidad;
        total += subtotal;
        html += `
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="display:flex;align-items:center;gap:8px;">
              <i class='fas fa-${getIconForService(servicio.service_id)}'></i>
              <span>${servicio.nombre} x${servicio.cantidad}</span>
            </div>
            <div style="text-align:right;min-width:110px;">
              <span style='font-size:0.95em;color:#ccc;'>$${servicio.precio.toLocaleString('es-AR')} c/u</span><br>
              <span style='font-weight:700;'>$${subtotal.toLocaleString('es-AR')}</span>
            </div>
          </div>
        `;
      });
      
      // Informaci√≥n del turno
      html += `<hr style='border:0;border-top:1.5px solid #ff3b3f;margin:18px 0 10px 0;'>`;
      html += `<div style='font-size:1.3rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;'><span>Total:</span> <span style='color:#fff;'>$${total.toLocaleString('es-AR')}</span></div>`;
      html += `<div style='margin-top:10px;'><strong>Fecha:</strong> ${turnosSeparados.vehiculos.fecha} - <strong>Hora:</strong> ${turnosSeparados.vehiculos.hora}</div>`;
      
      if (turnosSeparados.vehiculos.direccion) {
        if (typeof turnosSeparados.vehiculos.direccion === 'object') {
          html += `<div style='margin-top:5px;'><strong>Retiro:</strong> ${turnosSeparados.vehiculos.direccion.retiro}</div>`;
          html += `<div style='margin-top:5px;'><strong>Entrega:</strong> ${turnosSeparados.vehiculos.direccion.entrega}</div>`;
        } else {
          html += `<div style='margin-top:5px;'><strong>Direcci√≥n:</strong> ${turnosSeparados.vehiculos.direccion}</div>`;
        }
      }
      
      html += `</div></div>`;
      container.innerHTML = html;
    }
    
    function mostrarResumenTurnoTapizados() {
      const container = document.getElementById('resumen-turno-tapizados');
      const servicios = turnosSeparados.tapizados.servicios;
      
      let html = `
        <div style="background:#232323;border-radius:10px;overflow:hidden;">
          <div style="background:#ff3b3f;color:#fff;padding:10px 18px;font-weight:700;font-size:1.1rem;display:flex;align-items:center;gap:8px;">
            <i class='fas fa-couch'></i> Servicios de Tapizados
          </div>
          <div style="padding:18px 18px 10px 18px;">
      `;
      
      let total = 0;
      servicios.forEach(servicio => {
        const subtotal = servicio.precio * servicio.cantidad;
        total += subtotal;
        html += `
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="display:flex;align-items:center;gap:8px;">
              <i class='fas fa-${getIconForService(servicio.tipo)}'></i>
              <span>${servicio.nombre} x${servicio.cantidad}</span>
            </div>
            <div style="text-align:right;min-width:110px;">
              <span style='font-size:0.95em;color:#ccc;'>$${servicio.precio.toLocaleString('es-AR')} c/u</span><br>
              <span style='font-weight:700;'>$${subtotal.toLocaleString('es-AR')}</span>
            </div>
          </div>
        `;
      });
      
      // Informaci√≥n del turno
      html += `<hr style='border:0;border-top:1.5px solid #ff3b3f;margin:18px 0 10px 0;'>`;
      html += `<div style='font-size:1.3rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;'><span>Total:</span> <span style='color:#fff;'>$${total.toLocaleString('es-AR')}</span></div>`;
      html += `<div style='margin-top:10px;'><strong>Fecha:</strong> ${turnosSeparados.tapizados.fecha} - <strong>Hora:</strong> ${turnosSeparados.tapizados.hora}</div>`;
      html += `<div style='margin-top:5px;'><strong>Direcci√≥n:</strong> ${turnosSeparados.tapizados.direccion}</div>`;
      if (turnosSeparados.tapizados.detalles) {
        html += `<div style='margin-top:5px;'><strong>Detalles:</strong> ${turnosSeparados.tapizados.detalles}</div>`;
      }
      
      html += `</div></div>`;
      container.innerHTML = html;
    }
    
    function mostrarResumenTurnoUnico() {
      const resumenTurno = document.getElementById('resumen-turno');
      const categorias = categorizarServicios();
      
      let html = `
        <div style="background:#232323;border-radius:10px;overflow:hidden;">
          <div style="background:#ff3b3f;color:#fff;padding:10px 18px;font-weight:700;font-size:1.1rem;display:flex;align-items:center;gap:8px;">
            <i class='fas fa-list-ul'></i> Resumen de Servicios
          </div>
          <div style="padding:18px 18px 10px 18px;">
      `;
      
      let totalGeneral = 0;
      let servicios = [];
      
      if (categorias.hayVehiculos) {
        servicios = turnosSeparados.vehiculos.servicios;
      } else if (categorias.hayTapizados) {
        servicios = turnosSeparados.tapizados.servicios;
      }
      
      servicios.forEach(servicio => {
        const subtotal = servicio.precio * servicio.cantidad;
        totalGeneral += subtotal;
        html += `
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <div style="display:flex;align-items:center;gap:8px;">
              <i class='fas fa-${getIconForService(servicio.tipo)}'></i>
              <span>${servicio.nombre} x${servicio.cantidad}</span>
            </div>
            <div style="text-align:right;min-width:110px;">
              <span style='font-size:0.95em;color:#ccc;'>$${servicio.precio.toLocaleString('es-AR')} c/u</span><br>
              <span style='font-weight:700;'>$${subtotal.toLocaleString('es-AR')}</span>
            </div>
          </div>
        `;
      });

      // L√≠nea separadora
      html += `<hr style='border:0;border-top:1.5px solid #ff3b3f;margin:18px 0 10px 0;'>`;

      // Total general
      html += `<div style='font-size:1.3rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;'><span>Total General:</span> <span style='color:#fff;'>$${totalGeneral.toLocaleString('es-AR')}</span></div>`;

      html += `</div></div>`;

      resumenTurno.innerHTML = html;
    }
    
    function getIconForService(serviceId) {
      // Obtener el servicio por ID para determinar el tipo
      const servicio = getServicioPorId(serviceId);
      if (!servicio) return 'cog';
      
      const nombre = servicio.name.toLowerCase();
      if (nombre.includes('veh√≠culo') || nombre.includes('auto') || nombre.includes('suv') || nombre.includes('pickup')) return 'car';
      if (nombre.includes('tapizado') && nombre.includes('veh√≠culo')) return 'car-side';
      if (nombre.includes('motor')) return 'gears';
      if (nombre.includes('sill√≥n')) return 'couch';
      if (nombre.includes('silla')) return 'chair';
      if (nombre.includes('colch√≥n')) return 'bed';
      if (nombre.includes('alfombra')) return 'rug';
      if (nombre.includes('puff')) return 'couch';
      
      return 'cog';
    }

    selectServicio.addEventListener('change', function() {
     const val = this.value;
     const sillonTiposContainer = document.getElementById('sillon-tipos-container');
     const sillaTiposContainer = document.getElementById('silla-tipos-container');
     const colchonTiposContainer = document.getElementById('colchon-tipos-container');
     const vehiculoTiposContainer = document.getElementById('vehiculo-tipos-container');
     const motorTiposContainer = document.getElementById('motor-tipos-container');
     const alfombraTiposContainer = document.getElementById('alfombra-tipos-container');
     const puffTiposContainer = document.getElementById('puff-tipos-container');
     const servicioDetalle = document.getElementById('servicio-detalle');
     const sillonesSeleccionados = document.getElementById('sillones-seleccionados');
     const sillasSeleccionadas = document.getElementById('sillas-seleccionadas');
     const colchonesSeleccionados = document.getElementById('colchones-seleccionados');
     const vehiculosSeleccionados = document.getElementById('vehiculos-seleccionados');
     const motoresSeleccionados = document.getElementById('motores-seleccionados');
     const alfombrasSeleccionadas = document.getElementById('alfombras-seleccionadas');
     const puffsSeleccionados = document.getElementById('puffs-seleccionados');
     const totalSpan = document.getElementById('sillones-total');
     const totalSillasSpan = document.getElementById('sillas-total');
     const totalColchonesSpan = document.getElementById('colchones-total');
     const totalVehiculosSpan = document.getElementById('vehiculos-total');
     const totalMotoresSpan = document.getElementById('motores-total');
     const totalAlfombrasSpan = document.getElementById('alfombras-total');
     const totalPuffsSpan = document.getElementById('puffs-total');
     const tapizadovehiculoTiposContainer = document.getElementById('tapizadovehiculo-tipos-container');
     const tapizadovehiculosSeleccionados = document.getElementById('tapizadovehiculos-seleccionados');
     const totalTapizadoVehiculosSpan = document.getElementById('tapizadovehiculos-total');
     
     // Ocultar todo por defecto
     sillonTiposContainer.style.display = 'none';
     sillaTiposContainer.style.display = 'none';
     colchonTiposContainer.style.display = 'none';
     vehiculoTiposContainer.style.display = 'none';
     tapizadovehiculoTiposContainer.style.display = 'none';
     motorTiposContainer.style.display = 'none';
     alfombraTiposContainer.style.display = 'none';
     puffTiposContainer.style.display = 'none';
     servicioDetalle.style.display = 'none';
     sillonesSeleccionados.innerHTML = '';
     sillasSeleccionadas.innerHTML = '';
     colchonesSeleccionados.innerHTML = '';
     vehiculosSeleccionados.innerHTML = '';
     tapizadovehiculosSeleccionados.innerHTML = '';
     motoresSeleccionados.innerHTML = '';
     alfombrasSeleccionadas.innerHTML = '';
     puffsSeleccionados.innerHTML = '';
     totalSpan.innerHTML = '';
     totalSillasSpan.innerHTML = '';
     totalColchonesSpan.innerHTML = '';
     totalVehiculosSpan.innerHTML = '';
     totalTapizadoVehiculosSpan.innerHTML = '';
     totalMotoresSpan.innerHTML = '';
     totalAlfombrasSpan.innerHTML = '';
     totalPuffsSpan.innerHTML = '';
     document.getElementById('resumen-final').style.display = 'none';
     
     // Mostrar detalles del servicio (solo para servicios que no son sillones, sillas o colchones)
     if (servicios[val]) {
       const s = servicios[val];
       
       // Si es Limpieza de Sillones, mostrar botones de tipo
       if (val === 'Limpieza de Sillones') {
         sillonTiposContainer.style.display = 'block';
         renderSillonesCards();
         actualizarTotalSillones();
       } else if (val === 'Limpieza de Sillas') {
         sillaTiposContainer.style.display = 'block';
         renderSillasCards();
         actualizarTotalSillas();
       } else if (val === 'Limpieza de Colchones') {
         colchonTiposContainer.style.display = 'block';
         renderColchonesCards();
         actualizarTotalColchones();
       } else if (val === 'Limpieza de Veh√≠culo') {
         vehiculoTiposContainer.style.display = 'block';
         renderVehiculosCards();
         actualizarTotalVehiculos();
       } else if (val === 'Limpieza de Tapizado de Veh√≠culo') {
         tapizadovehiculoTiposContainer.style.display = 'block';
         renderTapizadoVehiculosCards();
         actualizarTotalTapizadoVehiculos();
       } else if (val === 'Limpieza de Motor') {
         motorTiposContainer.style.display = 'block';
         renderMotoresCards();
         actualizarTotalMotores();
       } else if (val === 'Limpieza de Alfombras') {
         alfombraTiposContainer.style.display = 'block';
         renderAlfombrasCards();
         actualizarTotalAlfombras();
       } else if (val === 'Limpieza de Puff') {
         puffTiposContainer.style.display = 'block';
         renderPuffsCards();
         actualizarTotalPuffs();
       } else {
         // Para otros servicios, mostrar la card normal
         servicioDetalle.innerHTML = `<div class="p-3 rounded bg-dark text-white"><i class='fas ${s.icon}'></i> <b>${val}</b> &nbsp; <span class='badge bg-dark text-danger'>${s.duracion} min</span> &nbsp; <span class='servicio-precio'>$${s.precio.toLocaleString('es-AR')}</span><br><span class='text-white small'>${s.desc}</span></div>`;
         servicioDetalle.style.display = 'block';
       }
       
       turno.servicio = val;
       turno.duracion = s.duracion;
       turno.precio = s.precio;
       document.getElementById('btn-siguiente-fijo').disabled = false;
     } else {
       servicioDetalle.style.display = 'none';
       document.getElementById('btn-siguiente-fijo').disabled = true;
     }
   });
   // Al cargar, deshabilitar siguiente si no hay servicio
   document.getElementById('btn-siguiente-fijo').disabled = true;
   // Paso 2: Seleccionar Profesional
   document.getElementById('btn-siguiente-fijo').onclick = function() {
     if (step === 1) {
       // Verificar que hay servicios seleccionados
       const categorias = categorizarServicios();
       if (!categorias.hayVehiculos && !categorias.hayTapizados) {
         alert('Por favor, selecciona al menos un servicio.');
         return;
       }
       step = 2;
       showStep(step);
     } else if (step === 2) {
       step = 3;
       showStep(step);
     } else if (step === 3) {
       // Guardar fechas y horas seg√∫n el tipo de turno
       const categorias = categorizarServicios();
       
       if (categorias.necesitaTurnosSeparados) {
         // Validar turnos separados
         const fechaVehiculos = document.getElementById('fecha-vehiculos').value;
         const horaVehiculos = document.getElementById('hora-vehiculos').value;
         const fechaTapizados = document.getElementById('fecha-tapizados').value;
         const horaTapizados = document.getElementById('hora-tapizados').value;
         
         if (!fechaVehiculos || !horaVehiculos || !fechaTapizados || !horaTapizados) {
           alert('Por favor, completa las fechas y horas para ambos turnos.');
           return;
         }
         
         // Guardar datos de veh√≠culos
         turnosSeparados.vehiculos.fecha = fechaVehiculos;
         turnosSeparados.vehiculos.hora = horaVehiculos;
         
         // Guardar datos de tapizados
         turnosSeparados.tapizados.fecha = fechaTapizados;
         turnosSeparados.tapizados.hora = horaTapizados;
         
       } else if (categorias.hayVehiculos) {
         // Solo servicios de veh√≠culos
         const fechaVehiculos = document.getElementById('fecha-vehiculos').value;
         const horaVehiculos = document.getElementById('hora-vehiculos').value;
         
         if (!fechaVehiculos || !horaVehiculos) {
           alert('Por favor, selecciona la fecha y hora del turno.');
           return;
         }
         
         turnosSeparados.vehiculos.fecha = fechaVehiculos;
         turnosSeparados.vehiculos.hora = horaVehiculos;
         
       } else if (categorias.hayTapizados) {
         // Solo servicios de tapizados
         const fechaTapizados = document.getElementById('fecha-tapizados').value;
         const horaTapizados = document.getElementById('hora-tapizados').value;
         
         if (!fechaTapizados || !horaTapizados) {
           alert('Por favor, selecciona la fecha y hora del turno.');
           return;
         }
         
         turnosSeparados.tapizados.fecha = fechaTapizados;
         turnosSeparados.tapizados.hora = horaTapizados;
       }
       
       step = 4;
       showStep(step);
     } else if (step === 4) {
       // Capturar datos personales
       turno.nombre = document.getElementById('nombre').value;
       turno.apellido = document.getElementById('apellido').value;
       if (!turno.nombre || !turno.apellido) {
         alert('Por favor, completa todos los campos obligatorios.');
         return;
       }
       step = 5;
       showStep(step);
     } else if (step === 5) {
       // Capturar datos de ubicaci√≥n seg√∫n el tipo de turno
       const categorias = categorizarServicios();
       
       if (categorias.necesitaTurnosSeparados) {
         // Validar ubicaciones separadas
         const direccionTapizados = document.getElementById('direccion-domicilio-input-tapizados')?.value;
         
         if (!direccionTapizados) {
           alert('Por favor, ingresa la direcci√≥n para los servicios de tapizados.');
           return;
         }
         
         turnosSeparados.tapizados.direccion = direccionTapizados;
         turnosSeparados.tapizados.detalles = document.getElementById('detalles-ubicacion-tapizados')?.value;
         
         // Para veh√≠culos, verificar retiro y entrega
         const retiroEntrega = document.querySelector('input[name="retiro-entrega-vehiculos"]:checked');
         if (retiroEntrega && retiroEntrega.value === 'si') {
           const direccionRetiro = document.getElementById('direccion-retiro-input-vehiculos')?.value;
           const direccionEntrega = document.getElementById('direccion-entrega-input-vehiculos')?.value;
           
           if (!direccionRetiro || !direccionEntrega) {
             alert('Por favor, completa las direcciones de retiro y entrega para veh√≠culos.');
             return;
           }
           
           turnosSeparados.vehiculos.direccion = { retiro: direccionRetiro, entrega: direccionEntrega };
         }
         
       } else if (categorias.hayVehiculos) {
         // Solo servicios de veh√≠culos
         const retiroEntrega = document.querySelector('input[name="retiro-entrega-vehiculos"]:checked');
         if (retiroEntrega && retiroEntrega.value === 'si') {
           const direccionRetiro = document.getElementById('direccion-retiro-input-vehiculos')?.value;
           const direccionEntrega = document.getElementById('direccion-entrega-input-vehiculos')?.value;
           
           if (!direccionRetiro || !direccionEntrega) {
             alert('Por favor, completa las direcciones de retiro y entrega.');
             return;
           }
           
           turnosSeparados.vehiculos.direccion = { retiro: direccionRetiro, entrega: direccionEntrega };
         }
         
       } else if (categorias.hayTapizados) {
         // Solo servicios de tapizados
         const direccionTapizados = document.getElementById('direccion-domicilio-input-tapizados')?.value;
         
         if (!direccionTapizados) {
           alert('Por favor, ingresa la direcci√≥n donde se realizar√° el servicio.');
           return;
         }
         
         turnosSeparados.tapizados.direccion = direccionTapizados;
         turnosSeparados.tapizados.detalles = document.getElementById('detalles-ubicacion-tapizados')?.value;
       }
       
       step = 6;
       showStep(step);
     }
   };
   document.getElementById('btn-confirmar-fijo').onclick = async function() {
     // Guardar turno en historial si el usuario est√° logueado
     const token = localStorage.getItem('token');
     if (token) {
       try {
         console.log('üíæ Guardando turno en historial...');
         const resultado = await guardarTurnoEnHistorial();
         if (resultado.success) {
           console.log('‚úÖ Turno guardado exitosamente en historial');
         } else {
           console.warn('‚ö†Ô∏è No se pudo guardar en historial:', resultado.message);
         }
       } catch (error) {
         console.error('‚ùå Error guardando en historial:', error);
       }
     } else {
       console.log('‚ÑπÔ∏è Usuario no logueado, no se guarda en historial');
     }

     // Confirmar turno y abrir WhatsApp
     const categorias = categorizarServicios();
     let mensaje = `¬°Hola! Quiero reservar turno(s) en Daytona Clean Service:%0A%0A`;
     mensaje += `Cliente: ${turno.nombre} ${turno.apellido}%0A%0A`;
     
     if (categorias.necesitaTurnosSeparados) {
       // Turnos separados
       mensaje += `üìÖ TURNOS SEPARADOS:%0A%0A`;
       
       // Turno de veh√≠culos
       if (turnosSeparados.vehiculos.servicios.length > 0) {
         mensaje += `üöó TURNO VEH√çCULOS:%0A`;
         mensaje += `Fecha: ${turnosSeparados.vehiculos.fecha} - Hora: ${turnosSeparados.vehiculos.hora}%0A`;
         mensaje += `Servicios:%0A`;
         
         let totalVehiculos = 0;
         turnosSeparados.vehiculos.servicios.forEach(servicio => {
           const subtotal = servicio.precio * servicio.cantidad;
           totalVehiculos += subtotal;
           mensaje += `  ‚Ä¢ ${servicio.nombre} x${servicio.cantidad} - $${subtotal.toLocaleString('es-AR')}%0A`;
         });
         mensaje += `Total Veh√≠culos: $${totalVehiculos.toLocaleString('es-AR')}%0A%0A`;
         
         if (turnosSeparados.vehiculos.direccion) {
           if (typeof turnosSeparados.vehiculos.direccion === 'object') {
             mensaje += `üìç Retiro: ${turnosSeparados.vehiculos.direccion.retiro}%0A`;
             mensaje += `üìç Entrega: ${turnosSeparados.vehiculos.direccion.entrega}%0A%0A`;
           }
         }
       }
       
       // Turno de tapizados
       if (turnosSeparados.tapizados.servicios.length > 0) {
         mensaje += `üõãÔ∏è TURNO TAPIZADOS:%0A`;
         mensaje += `Fecha: ${turnosSeparados.tapizados.fecha} - Hora: ${turnosSeparados.tapizados.hora}%0A`;
         mensaje += `Servicios:%0A`;
         
         let totalTapizados = 0;
         turnosSeparados.tapizados.servicios.forEach(servicio => {
           const subtotal = servicio.precio * servicio.cantidad;
           totalTapizados += subtotal;
           mensaje += `  ‚Ä¢ ${servicio.nombre} x${servicio.cantidad} - $${subtotal.toLocaleString('es-AR')}%0A`;
         });
         mensaje += `Total Tapizados: $${totalTapizados.toLocaleString('es-AR')}%0A%0A`;
         
         mensaje += `üìç Direcci√≥n: ${turnosSeparados.tapizados.direccion}%0A`;
         if (turnosSeparados.tapizados.detalles) {
           mensaje += `üìù Detalles: ${turnosSeparados.tapizados.detalles}%0A%0A`;
         }
       }
       
       // Total general
       const totalGeneral = (turnosSeparados.vehiculos.servicios.reduce((sum, s) => sum + (s.precio * s.cantidad), 0)) +
                           (turnosSeparados.tapizados.servicios.reduce((sum, s) => sum + (s.precio * s.cantidad), 0));
       mensaje += `üí∞ TOTAL GENERAL: $${totalGeneral.toLocaleString('es-AR')}%0A%0A`;
       
     } else {
       // Turno √∫nico
       mensaje += `üìÖ TURNO √öNICO:%0A`;
       
       let servicios = [];
       let fecha = '';
       let hora = '';
       let direccion = '';
       
       if (categorias.hayVehiculos) {
         servicios = turnosSeparados.vehiculos.servicios;
         fecha = turnosSeparados.vehiculos.fecha;
         hora = turnosSeparados.vehiculos.hora;
         if (turnosSeparados.vehiculos.direccion) {
           if (typeof turnosSeparados.vehiculos.direccion === 'object') {
             direccion = `Retiro: ${turnosSeparados.vehiculos.direccion.retiro} | Entrega: ${turnosSeparados.vehiculos.direccion.entrega}`;
           } else {
             direccion = turnosSeparados.vehiculos.direccion;
           }
         }
       } else if (categorias.hayTapizados) {
         servicios = turnosSeparados.tapizados.servicios;
         fecha = turnosSeparados.tapizados.fecha;
         hora = turnosSeparados.tapizados.hora;
         direccion = turnosSeparados.tapizados.direccion;
       }
       
       mensaje += `Fecha: ${fecha} - Hora: ${hora}%0A`;
       mensaje += `Servicios:%0A`;
       
       let total = 0;
       servicios.forEach(servicio => {
         const subtotal = servicio.precio * servicio.cantidad;
         total += subtotal;
         mensaje += `  ‚Ä¢ ${servicio.nombre} x${servicio.cantidad} - $${subtotal.toLocaleString('es-AR')}%0A`;
       });
       
       mensaje += `üí∞ Total: $${total.toLocaleString('es-AR')}%0A%0A`;
       
       if (direccion) {
         mensaje += `üìç Direcci√≥n: ${direccion}%0A%0A`;
       }
     }
     
     mensaje += `Gracias! üôè`;
     
    // Mostrar mensaje de √©xito (sin abrir WhatsApp autom√°ticamente)
     document.getElementById('wizard-content').style.display = 'none';
     document.getElementById('turno-exito').style.display = 'block';
     document.getElementById('btn-confirmar-fijo').style.display = 'none';
     
     // Actualizar mensaje seg√∫n si est√° logueado o no
     const mensajeExito = document.querySelector('#turno-exito .alert p');
     const botonesExito = document.getElementById('botones-exito');
     
     if (token) {
       mensajeExito.innerHTML = 'Tu turno ha sido guardado en nuestro historial y en tu perfil. Te contactaremos pronto para coordinar los detalles de tu servicio.';
       botonesExito.innerHTML = `
         <a href="mi-cuenta.html" class="btn btn-primary me-2">
           <i class="fas fa-user me-1"></i>Ver mi perfil
         </a>
         <a href="turnos.html" class="btn btn-outline-light">
           <i class="fas fa-plus me-1"></i>Agendar otro turno
         </a>
       `;
     } else {
       mensajeExito.innerHTML = 'Tu turno ha sido procesado. Te contactaremos pronto para coordinar los detalles de tu servicio.';
       botonesExito.innerHTML = `
         <a href="login.html" class="btn btn-primary me-2">
           <i class="fas fa-sign-in-alt me-1"></i>Crear cuenta
         </a>
         <a href="turnos.html" class="btn btn-outline-light">
           <i class="fas fa-plus me-1"></i>Agendar otro turno
         </a>
       `;
     }
   }

   // L√≥gica para mostrar/ocultar y mover los botones fijos seg√∫n el paso
   function actualizarBotoneraFija() {
     const anterior = document.getElementById('btn-anterior-fijo');
     const siguiente = document.getElementById('btn-siguiente-fijo');
     const confirmar = document.getElementById('btn-confirmar-fijo');
     anterior.style.display = (step > 1 && step < 7) ? '' : 'none';
     siguiente.style.display = (step >= 1 && step < 6) ? '' : 'none';
     confirmar.style.display = (step === 6) ? '' : 'none';
   }
   // Ocultar los botones originales de cada paso
   function ocultarBotonesOriginales() {
     const ids = [
       'to-step-2', 'to-step-3', 'back-to-1', 'back-to-2', 'back-to-3', 'back-to-4',
       'confirmar-turno'
     ];
     ids.forEach(id => {
       const btn = document.getElementById(id);
       if (btn) btn.style.display = 'none';
     });
   }
   // Eventos para los botones fijos
   document.getElementById('btn-anterior-fijo').onclick = function() {
     if (step === 2) step = 1;
     else if (step === 3) step = 2;
     else if (step === 4) step = 3;
     else if (step === 5) step = 4;
     else if (step === 6) step = 5;
     showStep(step);
     actualizarBotoneraFija();
     ocultarBotonesOriginales();
   };
   // Al mostrar cada paso, actualizar la botonera fija y ocultar los botones originales
   const oldShowStep = showStep;
   showStep = function(n) {
     oldShowStep(n);
     actualizarBotoneraFija();
     ocultarBotonesOriginales();
   };
   // Inicializar botonera fija al cargar
   actualizarBotoneraFija();
   ocultarBotonesOriginales();
   // L√≥gica para mostrar opciones de sillones con botones de tipo y controles de cantidad
   // Event listeners para los botones de tipo de sill√≥n
   const sillonTipos = document.querySelectorAll('input[name="sillon-tipo"]');
   const sillonesSeleccionados = document.getElementById('sillones-seleccionados');
   const totalSpan = document.getElementById('sillones-total');

   // Cuando se selecciona un tipo de sill√≥n
   sillonTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = sillonesAgregados.find(s => s.nombre === armarNombreServicio('sillon', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('sillon', tipoSeleccionado, 1);
       }
       
       renderSillonesCards();
       actualizarTotalSillones();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de silla
   const sillaTipos = document.querySelectorAll('input[name="silla-tipo"]');
   const sillasSeleccionadas = document.getElementById('sillas-seleccionadas');
   const totalSillasSpan = document.getElementById('sillas-total');

   // Cuando se selecciona un tipo de silla
   sillaTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = sillasAgregadas.find(s => s.nombre === armarNombreServicio('silla', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('silla', tipoSeleccionado, 1);
       }
       
       renderSillasCards();
       actualizarTotalSillas();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de colch√≥n
   const colchonTipos = document.querySelectorAll('input[name="colchon-tipo"]');
   const colchonesSeleccionados = document.getElementById('colchones-seleccionados');
   const totalColchonesSpan = document.getElementById('colchones-total');

   // Cuando se selecciona un tipo de colch√≥n
   colchonTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = colchonesAgregados.find(c => c.nombre === armarNombreServicio('colchon', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('colchon', tipoSeleccionado, 1);
       }
       
       renderColchonesCards();
       actualizarTotalColchones();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de veh√≠culo
   const vehiculoTipos = document.querySelectorAll('input[name="vehiculo-tipo"]');
   const vehiculosSeleccionados = document.getElementById('vehiculos-seleccionados');
   const totalVehiculosSpan = document.getElementById('vehiculos-total');

   // Cuando se selecciona un tipo de veh√≠culo
   vehiculoTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = vehiculosAgregados.find(v => v.nombre === armarNombreServicio('vehiculo', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('vehiculo', tipoSeleccionado, 1);
       }
       
       renderVehiculosCards();
       actualizarTotalVehiculos();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de motor
   const motorTipos = document.querySelectorAll('input[name="motor-tipo"]');
   const motoresSeleccionados = document.getElementById('motores-seleccionados');
   const totalMotoresSpan = document.getElementById('motores-total');

   // Cuando se selecciona un tipo de motor
   motorTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = motoresAgregados.find(m => m.nombre === armarNombreServicio('motor', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('motor', tipoSeleccionado, 1);
       }
       
       renderMotoresCards();
       actualizarTotalMotores();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de alfombra
   const alfombraTipos = document.querySelectorAll('input[name="alfombra-tipo"]');
   const alfombrasSeleccionadas = document.getElementById('alfombras-seleccionadas');
   const totalAlfombrasSpan = document.getElementById('alfombras-total');

   // Cuando se selecciona un tipo de alfombra
   alfombraTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = alfombrasAgregadas.find(a => a.nombre === armarNombreServicio('alfombra', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('alfombra', tipoSeleccionado, 1);
       }
       
       renderAlfombrasCards();
       actualizarTotalAlfombras();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de puff
   const puffTipos = document.querySelectorAll('input[name="puff-tipo"]');
   const puffsSeleccionados = document.getElementById('puffs-seleccionados');
   const totalPuffsSpan = document.getElementById('puffs-total');

   // Cuando se selecciona un tipo de puff
   puffTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       
       // Verificar si ya existe este tipo
       const existe = puffsAgregados.find(p => p.nombre === armarNombreServicio('puff', tipoSeleccionado));
       if (existe) {
         // Si ya existe, aumentar cantidad
         existe.cantidad++;
       } else {
         // Si no existe, agregar nuevo usando la funci√≥n centralizada
         agregarServicioSeleccionado('puff', tipoSeleccionado, 1);
       }
       
       renderPuffsCards();
       actualizarTotalPuffs();
       
       // Desmarcar el radio button para poder seleccionar otro tipo
       this.checked = false;
     });
   });

   // Event listeners para los botones de tipo de tapizado de veh√≠culo
   const tapizadovehiculoTipos = document.querySelectorAll('input[name="tapizadovehiculo-tipo"]');
   const tapizadovehiculosSeleccionados = document.getElementById('tapizadovehiculos-seleccionados');
   const totalTapizadoVehiculosSpan = document.getElementById('tapizadovehiculos-total');

   // Cuando se selecciona un tipo de tapizado de veh√≠culo
   tapizadovehiculoTipos.forEach(radio => {
     radio.addEventListener('change', function() {
       const tipoSeleccionado = this.value;
       // Verificar si ya existe este tipo
       const existe = tapizadoVehiculosAgregados.find(tv => tv.nombre === armarNombreServicio('tapizadoVehiculo', tipoSeleccionado));
       if (existe) {
         existe.cantidad++;
       } else {
         agregarServicioSeleccionado('tapizadoVehiculo', tipoSeleccionado, 1);
       }
       renderTapizadoVehiculosCards();
       actualizarTotalTapizadoVehiculos();
       this.checked = false;
     });
   });

  // ===== INTEGRACI√ìN CON BACKEND =====

  // Funci√≥n para obtener disponibilidad de horarios
  async function obtenerDisponibilidad(fecha) {
    try {
      const response = await apiService.getAvailability(fecha);
      
      if (response.success) {
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Error obteniendo disponibilidad:', error);
      throw error;
    }
  }

  // Funci√≥n para crear turno en el backend
  async function crearTurnoEnBackend(datosTurno) {
    try {
      const response = await apiService.createAppointment(datosTurno);
      
      if (response.success) {
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Error creando turno:', error);
      throw error;
    }
  }

  // Funci√≥n para actualizar el paso 3 con disponibilidad real
  async function actualizarDisponibilidadPaso3() {
    const categorizacion = categorizarServicios();
    const paso3 = document.getElementById('paso-3');
    
    if (categorizacion.necesitaTurnosSeparados) {
      // Mostrar dos secciones para turnos separados
      paso3.innerHTML = `
        <div class="row">
          <div class="col-md-6">
            <h4><i class="fas fa-car me-2"></i>Turno para Veh√≠culos</h4>
            <div class="mb-3">
              <label class="form-label">Fecha:</label>
              <input type="date" id="fecha-vehiculos" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Hora:</label>
              <select id="hora-vehiculos" class="form-control" required>
                <option value="">Selecciona una fecha primero</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <h4><i class="fas fa-couch me-2"></i>Turno para Tapizados</h4>
            <div class="mb-3">
              <label class="form-label">Fecha:</label>
              <input type="date" id="fecha-tapizados" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Hora:</label>
              <select id="hora-tapizados" class="form-control" required>
                <option value="">Selecciona una fecha primero</option>
              </select>
            </div>
          </div>
        </div>
      `;
      
      // Event listeners para fechas
      document.getElementById('fecha-vehiculos').addEventListener('change', async function() {
        await cargarHorariosDisponibles(this.value, 'hora-vehiculos');
      });
      
      document.getElementById('fecha-tapizados').addEventListener('change', async function() {
        await cargarHorariosDisponibles(this.value, 'hora-tapizados');
      });
      
    } else {
      // Mostrar una sola secci√≥n
      const categoria = categorizacion.hayVehiculos ? 'vehiculos' : 'tapizados';
      const icono = categorizacion.hayVehiculos ? 'fas fa-car' : 'fas fa-couch';
      const titulo = categorizacion.hayVehiculos ? 'Turno para Veh√≠culos' : 'Turno para Tapizados';
      
      paso3.innerHTML = `
        <h4><i class="${icono} me-2"></i>${titulo}</h4>
        <div class="mb-3">
          <label class="form-label">Fecha:</label>
          <input type="date" id="fecha-${categoria}" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Hora:</label>
          <select id="hora-${categoria}" class="form-control" required>
            <option value="">Selecciona una fecha primero</option>
          </select>
        </div>
      `;
      
      // Event listener para fecha
      document.getElementById(`fecha-${categoria}`).addEventListener('change', async function() {
        await cargarHorariosDisponibles(this.value, `hora-${categoria}`);
      });
    }
  }

  // Funci√≥n para cargar horarios disponibles
  async function cargarHorariosDisponibles(fecha, selectId) {
    const select = document.getElementById(selectId);
    select.innerHTML = '<option value="">Cargando horarios...</option>';
    
    try {
      const disponibilidad = await obtenerDisponibilidad(fecha);
      
      if (!disponibilidad.isWorkingDay) {
        select.innerHTML = '<option value="">No hay horarios disponibles</option>';
        return;
      }
      
      if (disponibilidad.isBlocked) {
        select.innerHTML = `<option value="">D√≠a bloqueado: ${disponibilidad.reason}</option>`;
        return;
      }
      
      const opciones = disponibilidad.availableSlots
        .filter(slot => slot.available)
        .map(slot => `<option value="${slot.startTime}">${slot.startTime} - ${slot.endTime}</option>`)
        .join('');
      
      select.innerHTML = opciones || '<option value="">No hay horarios disponibles</option>';
      
    } catch (error) {
      select.innerHTML = '<option value="">Error cargando horarios</option>';
      console.error('Error cargando horarios:', error);
    }
  }

  // Funci√≥n para confirmar turno con backend
  async function confirmarTurnoConBackend() {
    // Confirmar turno y abrir WhatsApp
    const categorias = categorizarServicios();
    let mensaje = `¬°Hola! Quiero reservar turno(s) en Daytona Clean Service:%0A%0A`;
    mensaje += `Cliente: ${turno.nombre} ${turno.apellido}%0A%0A`;
    
    // --- NUEVO: Armar datos para backend ---
    let turnoParaBackend = {};
    let servicios = [];
    let fecha = '';
    let hora = '';
    let direccion = '';
    let total = 0;
    let tipo = '';
    if (categorias.hayVehiculos) {
      servicios = turnosSeparados.vehiculos.servicios;
      fecha = turnosSeparados.vehiculos.fecha;
      hora = turnosSeparados.vehiculos.hora;
      tipo = 'vehiculo';
      if (turnosSeparados.vehiculos.direccion) {
        if (typeof turnosSeparados.vehiculos.direccion === 'object') {
          direccion = `Retiro: ${turnosSeparados.vehiculos.direccion.retiro} | Entrega: ${turnosSeparados.vehiculos.direccion.entrega}`;
        } else {
          direccion = turnosSeparados.vehiculos.direccion;
        }
      }
    } else if (categorias.hayTapizados) {
      servicios = turnosSeparados.tapizados.servicios;
      fecha = turnosSeparados.tapizados.fecha;
      hora = turnosSeparados.tapizados.hora;
      tipo = 'tapizado';
      direccion = turnosSeparados.tapizados.direccion;
    }
    total = servicios.reduce((acc, s) => acc + (s.precio * s.cantidad), 0);
    
    // Armar objeto para backend
    turnoParaBackend = {
      clientName: turno.nombre + ' ' + turno.apellido,
      clientPhone: turno.telefono,
      clientEmail: turno.email,
      appointmentDate: fecha,
      startTime: hora,
      services: servicios.map(s => ({
        name: s.nombre,
        quantity: s.cantidad,
        price: s.precio
      })),
      totalAmount: total,
      notes: '',
      serviceLocation: direccion
    };
    // Si el usuario est√° logueado, agregar userId
    const userData = localStorage.getItem('userData');
    if (userData) {
      const user = JSON.parse(userData);
      turnoParaBackend.userId = user.id;
    }
    // --- FIN NUEVO ---
    // --- Enviar al backend ---
    try {
      const response = await fetch('https://daytona-clean-service.onrender.com/api/appointments', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          ...(localStorage.getItem('token') ? { 'Authorization': `Bearer ${localStorage.getItem('token')}` } : {})
        },
        body: JSON.stringify(turnoParaBackend)
      });
      const data = await response.json();
      if (!data.success) {
        mostrarError('Error al guardar el turno: ' + (data.message || '')); 
        return;
      }
    } catch (err) {
      mostrarError('Error de conexi√≥n al guardar el turno');
      return;
    }
    // ... existing code ...
  }

  // Funci√≥n para obtener ID del servicio por nombre
  function obtenerIdServicio(nombre) {
    const mapeoServicios = {
      'Lavado de Auto': 1,
      'Lavado de SUV': 2,
      'Lavado de Pickup': 3,
      'Limpieza de Motor B√°sica': 4,
      'Limpieza de Motor Completa': 5,
      'Limpieza de Motor Detallada': 6,
      'Tapizado de Auto': 7,
      'Tapizado de SUV': 8,
      'Tapizado de Pickup': 9,
      'Sill√≥n 1 Cuerpo': 10,
      'Sill√≥n 2 Cuerpos': 11,
      'Sill√≥n 3 Cuerpos': 12,
      'Silla Simple': 13,
      'Silla Gamer': 14,
      'Silla Oficina': 15,
      'Silla Comedor': 16,
      'Colch√≥n 1 Plaza': 17,
      'Colch√≥n 2 Plazas': 18,
      'Alfombra Chica': 19,
      'Alfombra Mediana': 20,
      'Alfombra Grande': 21,
      'Alfombra Persa': 22,
      'Puff Simple': 23,
      'Puff Grande': 24,
      'Puff Especial': 25
    };
    
    return mapeoServicios[nombre] || 1;
  }

  // Funci√≥n para mostrar confirmaci√≥n
  function mostrarConfirmacion(mensaje) {
    const modal = new bootstrap.Modal(document.getElementById('confirmacionModal'));
    document.getElementById('confirmacionMensaje').textContent = mensaje;
    modal.show();
  }

  // Funci√≥n para mostrar error
  function mostrarError(mensaje) {
    const modal = new bootstrap.Modal(document.getElementById('errorModal'));
    document.getElementById('errorMensaje').textContent = mensaje;
    modal.show();
  }

  // Funci√≥n para generar mensaje de confirmaci√≥n
  function generarMensajeConfirmacion(turno) {
    const servicios = turno.services.map(s => `${s.service_name} x${s.quantity}`).join(', ');
    return `¬°Hola! Tu turno ha sido confirmado:

üìÖ Fecha: ${turno.appointment_date}
‚è∞ Hora: ${turno.start_time}
üë§ Cliente: ${turno.client_name}
üìû Tel√©fono: ${turno.client_phone}
üìç Direcci√≥n: ${turno.address || 'A confirmar'}
üõ†Ô∏è Servicios: ${servicios}
üí∞ Total: $${turno.total_amount}

¬°Gracias por elegir Daytona Clean Service! üöó‚ú®`;
  }

  // Funci√≥n para generar mensaje de confirmaci√≥n separado
  function generarMensajeConfirmacionSeparado(turnoVehiculos, turnoTapizados) {
    const serviciosVehiculos = turnoVehiculos.services.map(s => `${s.service_name} x${s.quantity}`).join(', ');
    const serviciosTapizados = turnoTapizados.services.map(s => `${s.service_name} x${s.quantity}`).join(', ');
    
    return `¬°Hola! Tus turnos han sido confirmados:

üöó TURNO VEH√çCULOS:
üìÖ Fecha: ${turnoVehiculos.appointment_date}
‚è∞ Hora: ${turnoVehiculos.start_time}
üõ†Ô∏è Servicios: ${serviciosVehiculos}
üí∞ Total: $${turnoVehiculos.total_amount}

üõãÔ∏è TURNO TAPIZADOS:
üìÖ Fecha: ${turnoTapizados.appointment_date}
‚è∞ Hora: ${turnoTapizados.start_time}
üõ†Ô∏è Servicios: ${serviciosTapizados}
üí∞ Total: $${turnoTapizados.total_amount}

üë§ Cliente: ${turnoVehiculos.client_name}
üìû Tel√©fono: ${turnoVehiculos.client_phone}

¬°Gracias por elegir Daytona Clean Service! üöó‚ú®`;
  }

  // Mostrar/ocultar campos seg√∫n el tipo de servicio seleccionado
  function actualizarCamposDireccion() {
    const hayVehiculos = window.categorias && window.categorias.hayVehiculos;
    const hayTapizados = window.categorias && window.categorias.hayTapizados;
    document.getElementById('direccion-vehiculo-group').style.display = hayVehiculos ? 'block' : 'none';
    document.getElementById('direccion-tapizado-group').style.display = hayTapizados ? 'block' : 'none';
  }
  // Llamar esta funci√≥n cada vez que se cambia el tipo de servicio
  // ... existing code ...
  // L√≥gica para armar el campo serviceLocation en confirmarTurnoConBackend
  // ... dentro de confirmarTurnoConBackend ...
  let direccion = '';
  if (categorias.hayVehiculos) {
    const modoEntrega = document.getElementById('vehiculo-entrega-select').value;
    if (modoEntrega === 'buscar') {
      const retiro = document.getElementById('direccion-retiro').value.trim();
      const entrega = document.getElementById('direccion-entrega').value.trim();
      direccion = `Retiro: ${retiro} | Entrega: ${entrega}`;
    } else {
      direccion = 'El cliente lleva el veh√≠culo';
    }
  } else if (categorias.hayTapizados) {
    direccion = document.getElementById('direccion-tapizado').value.trim();
  }
  // ... luego usar direccion como serviceLocation en el objeto para el backend
  // ... existing code ...

  });

  // Funci√≥n para obtener el paso actual
  function obtenerPasoActual() {
    return window.step || 1;
  }
  
  // Funci√≥n para ir al siguiente paso
  function siguientePaso() {
    const currentStep = window.step || 1;
    if (currentStep < 6) {
      window.step = currentStep + 1;
      // Usar la funci√≥n showStep que ya existe en el scope
      if (typeof showStep === 'function') {
        showStep(window.step);
      } else {
        console.warn('‚ö†Ô∏è Funci√≥n showStep no disponible');
      }
    }
  }

  // Actualizar la funci√≥n del bot√≥n siguiente para usar el backend
    const btnSiguiente = document.getElementById('btn-siguiente-fijo');
    if (btnSiguiente) {
      btnSiguiente.addEventListener('click', async function() {
        const pasoActual = obtenerPasoActual();
        
        if (pasoActual === 2) {
          // Al pasar al paso 3, actualizar disponibilidad
        if (typeof actualizarDisponibilidadPaso3 === 'function') {
          await actualizarDisponibilidadPaso3();
        } else {
          console.warn('‚ö†Ô∏è Funci√≥n actualizarDisponibilidadPaso3 no disponible');
        }
        }
        
        siguientePaso();
      });
    }

    // Actualizar la funci√≥n del bot√≥n confirmar
    const btnConfirmar = document.getElementById('btn-confirmar');
    if (btnConfirmar) {
      btnConfirmar.addEventListener('click', async function() {
        await confirmarTurnoConBackend();
      });
    }

    // Restringir fechas pasadas en los inputs de fecha
    const hoy = new Date();
    const yyyy = hoy.getFullYear();
    const mm = String(hoy.getMonth() + 1).padStart(2, '0');
    const dd = String(hoy.getDate()).padStart(2, '0');
    const minDate = `${yyyy}-${mm}-${dd}`;
    const inputsFecha = [
      document.getElementById('fecha-vehiculos'),
      document.getElementById('fecha-tapizados'),
      document.getElementById('fecha')
    ];
    inputsFecha.forEach(input => { if (input) input.setAttribute('min', minDate); });

    // L√≥gica para deshabilitar horarios ocupados en veh√≠culos y tapizados
    async function actualizarHorariosDisponibles(fecha, selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      // Habilitar todos los horarios primero
      Array.from(select.options).forEach(opt => { opt.disabled = false; });
      if (!fecha) return;
      try {
        const disponibilidad = await obtenerDisponibilidad(fecha);
        if (disponibilidad && Array.isArray(disponibilidad.ocupados)) {
          disponibilidad.ocupados.forEach(horaOcupada => {
            const opt = Array.from(select.options).find(o => o.value === horaOcupada);
            if (opt) opt.disabled = true;
          });
        }
      } catch (e) {
        console.error('Error consultando disponibilidad:', e);
      }
    }
    // Event listeners para fechas
    document.getElementById('fecha-vehiculos')?.addEventListener('change', function() {
      actualizarHorariosDisponibles(this.value, 'hora-vehiculos');
    });
    document.getElementById('fecha-tapizados')?.addEventListener('change', function() {
      actualizarHorariosDisponibles(this.value, 'hora-tapizados');
    });

  // --- L√≥gica profesional de armado de nombres y b√∫squeda de precios ---

  function armarNombreServicio(tipo, subtipo) {
    if (tipo === "vehiculo") {
      // Ej: "Limpieza de Auto"
      return `Limpieza de ${capitalizarPrimeraLetra(subtipo)}`;
    }
    if (tipo === "tapizadoVehiculo") {
      // Mapear subtipo a nombre exacto de la BD
      if (subtipo === 'auto') return 'Limpieza de Tapizado de Auto';
      if (subtipo === 'suv') return 'Limpieza de Tapizado de SUV';
      if (subtipo === 'pickup') return 'Limpieza de Tapizado de Pickup';
      return '';
    }
    if (tipo === "motor") {
      // Mapear subtipo a nombre exacto de la BD
      if (subtipo === 'completa') return 'Motor Completa';
      if (subtipo === 'detallada') return 'Motor Detallada';
      return '';
    }
    if (tipo === "sillon") return `Sill√≥n ${subtipo}`;
    if (tipo === "silla") return `Silla ${subtipo}`;
    if (tipo === "colchon") return `Colch√≥n de ${subtipo}`;
    if (tipo === "puff") {
      // Mapear subtipo a nombre exacto de la BD
      if (subtipo === 'chico') return 'Puff chico';
      if (subtipo === 'mediano') return 'Puff mediano';
      if (subtipo === 'grande') return 'Puff grande';
      return '';
    }
    if (tipo === "tapizadoSilla") return `Limpieza de Tapizado de Silla`;
    if (tipo === "tapizadoAlfombra") return `Limpieza de Tapizado de Alfombra`;
    return "";
  }

  function capitalizarPrimeraLetra(str) {
    if (!str) return '';
    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
  }

  function getPrecioDesdeBD(tipo, subtipo) {
    const nombre = armarNombreServicio(tipo, subtipo);
    const servicio = serviciosBD.find(s => s.name === nombre);
    return servicio ? servicio.price : 0;
  }

  // Reemplazar en TODO el archivo cualquier referencia a precios hardcodeados o funciones viejas de precios
  // Usar SIEMPRE getPrecioDesdeBD(tipo, subtipo) para mostrar precios en cards, resumen, confirmaci√≥n, etc.
  // Ejemplo de uso:
  // const precio = getPrecioDesdeBD('vehiculo', 'SUV');
  // const precio = getPrecioDesdeBD('sillon', '2 cuerpos');
  // ... existing code ...

  // --- Refactor profesional: trabajar siempre con service_id ---

  function getServicioPorId(serviceId) {
    return serviciosBD.find(s => s.id === serviceId);
  }

  // Al agregar un servicio, buscar el objeto en serviciosBD y guardar el id
  function agregarServicioSeleccionado(tipo, subtipo, cantidad) {
    // Buscar el servicio en la BD por nombre exacto
    let nombre = armarNombreServicio(tipo, subtipo);
    let servicio = serviciosBD.find(s => s.name === nombre);
    if (!servicio) {
      console.error('No se encontr√≥ el servicio en la BD:', nombre);
      return;
    }
    // Agregar al array correspondiente
    let obj = {
      service_id: servicio.id,
      nombre: servicio.name,
      cantidad: cantidad,
      precio: servicio.price
    };
    
    // Agregar al array correspondiente seg√∫n el tipo
    switch(tipo) {
      case 'sillon':
        sillonesAgregados.push(obj);
        break;
      case 'silla':
        sillasAgregadas.push(obj);
        break;
      case 'colchon':
        colchonesAgregados.push(obj);
        break;
      case 'vehiculo':
        vehiculosAgregados.push(obj);
        break;
      case 'tapizadoVehiculo':
        tapizadoVehiculosAgregados.push(obj);
        break;
      case 'motor':
        motoresAgregados.push(obj);
        break;
      case 'alfombra':
        alfombrasAgregadas.push(obj);
        break;
      case 'puff':
        puffsAgregados.push(obj);
        break;
      default:
        console.error('Tipo de servicio no reconocido:', tipo);
        return;
    }
    
    console.log(`‚úÖ Servicio agregado: ${nombre} (ID: ${servicio.id})`);
  }

  // Para mostrar el precio en cards y resumen:
  function getPrecioPorId(serviceId) {
    const servicio = getServicioPorId(serviceId);
    return servicio ? servicio.price : 0;
  }

  // Al armar el request al backend:
  function armarServiciosParaBackend(arrayServicios) {
    return arrayServicios.map(s => ({
      service_id: s.service_id,
      quantity: s.cantidad
    }));
  }
  // ... existing code ...



</script>
</body>
</html> 